<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>stable_learning_control.utils.eval_robustness &mdash; stable-learning-control 6.0.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=fa44fd50" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../../../_static/graphviz.css?v=eafc0fe6" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/modify.css?v=519ed47b" />

  
    <link rel="shortcut icon" href="../../../_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js?v=9497d378"></script>
        <script src="../../../_static/doctools.js?v=888ff710"></script>
        <script src="../../../_static/sphinx_highlight.js?v=4825356b"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html">
            
              <img src="../../../_static/logo.svg" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                6.0.1
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Usage</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../usage/installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../usage/docker.html">Use with Docker</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../usage/algorithms.html">Available Agents</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../usage/running.html">Running Experiments</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../usage/hyperparameter_tuning.html">Hyperparameter Tuning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../usage/saving_and_loading.html">Experiment Outputs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../usage/plotting.html">Plotting Results</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../usage/eval_robustness.html">Evaluating Robustness</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../usage/benchmarks.html">Benchmarks</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Utilities</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../utils/loggers.html">Loggers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../utils/mpi.html">MPI Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../utils/run_utils.html">Run Utils</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../utils/plotter.html">Plotter</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../utils/testers.html">Policy testers</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Development</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../dev/contributing.html">Contribute to stable-learning-control</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../dev/doc_dev.html">Build the documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../dev/license.html">License</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../autoapi/index.html">API Reference</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Etc.</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../etc/acknowledgements.html">Acknowledgements</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">stable-learning-control</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Module code</a></li>
      <li class="breadcrumb-item active">stable_learning_control.utils.eval_robustness</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for stable_learning_control.utils.eval_robustness</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;Contains a utility that can be used to evaluate the stability and robustness of an</span>
<span class="sd">algorithm. See the :ref:`Robustness Evaluation Documentation &lt;robustness_eval&gt;` for</span>
<span class="sd">more information.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">ast</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">importlib</span>
<span class="kn">import</span> <span class="nn">inspect</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span><span class="p">,</span> <span class="n">PurePath</span>
<span class="kn">from</span> <span class="nn">textwrap</span> <span class="kn">import</span> <span class="n">dedent</span>

<span class="kn">import</span> <span class="nn">gymnasium</span> <span class="k">as</span> <span class="nn">gym</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>

<span class="kn">from</span> <span class="nn">stable_learning_control.common.helpers</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">convert_to_snake_case</span><span class="p">,</span>
    <span class="n">convert_to_wandb_config</span><span class="p">,</span>
    <span class="n">friendly_err</span><span class="p">,</span>
    <span class="n">get_env_id</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">stable_learning_control.utils.log_utils.helpers</span> <span class="kn">import</span> <span class="n">log_to_std_out</span>
<span class="kn">from</span> <span class="nn">stable_learning_control.utils.log_utils.logx</span> <span class="kn">import</span> <span class="n">EpochLogger</span>
<span class="kn">from</span> <span class="nn">stable_learning_control.utils.test_policy</span> <span class="kn">import</span> <span class="n">load_policy_and_env</span>


<div class="viewcode-block" id="get_human_readable_disturber_label"><a class="viewcode-back" href="../../../autoapi/stable_learning_control/utils/eval_robustness/index.html#stable_learning_control.utils.eval_robustness.get_human_readable_disturber_label">[docs]</a><span class="k">def</span> <span class="nf">get_human_readable_disturber_label</span><span class="p">(</span><span class="n">disturber_label</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get a human readable label for a given disturber label.</span>

<span class="sd">    Args:</span>
<span class="sd">        disturber_label (str): The disturber label.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: The human readable disturber label.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">human_str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">disturber_label</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)):</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">human_str</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">s</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">elif</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">human_str</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;, </span><span class="si">{</span><span class="n">s</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">human_str</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;=</span><span class="si">{</span><span class="n">s</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">return</span> <span class="n">human_str</span></div>


<div class="viewcode-block" id="add_disturbance_label_column"><a class="viewcode-back" href="../../../autoapi/stable_learning_control/utils/eval_robustness/index.html#stable_learning_control.utils.eval_robustness.add_disturbance_label_column">[docs]</a><span class="k">def</span> <span class="nf">add_disturbance_label_column</span><span class="p">(</span><span class="n">dataframe</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Add a column that contains a disturbance label. This label will be created</span>
<span class="sd">    by concatenating all disturber parameters.</span>

<span class="sd">    .. note::</span>
<span class="sd">        This function will not add a disturbance label if the dataframe already contains</span>
<span class="sd">        a disturbance label.</span>

<span class="sd">    Args:</span>
<span class="sd">        dataframe (pd.DataFrame): The dataframe containing the disturber parameters.</span>

<span class="sd">    Returns:</span>
<span class="sd">        pd.DataFrame: The dataframe with the disturbance label column.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If the dataframe does not contain a &#39;disturber&#39; column.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Return dataframe if it already contains a disturbance label.</span>
    <span class="k">if</span> <span class="s2">&quot;disturbance_label&quot;</span> <span class="ow">in</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">dataframe</span><span class="p">[</span><span class="s2">&quot;disturbance_label&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s2">&quot;baseline&quot;</span><span class="p">)</span>

    <span class="c1"># Create disturbance label.</span>
    <span class="k">if</span> <span class="s2">&quot;disturber&quot;</span> <span class="ow">in</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="n">disturbance_label_df</span> <span class="o">=</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
            <span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="p">(</span>
                <span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                    <span class="p">[</span>
                        <span class="s2">&quot;</span><span class="si">{key}</span><span class="s2">_</span><span class="si">{value}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                            <span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">],</span>
                            <span class="n">value</span><span class="o">=</span><span class="p">(</span>
                                <span class="nb">round</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span> <span class="k">else</span> <span class="n">value</span>
                            <span class="p">),</span>
                        <span class="p">)</span>
                        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">row</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                        <span class="k">if</span> <span class="n">key</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;disturber_&quot;</span><span class="p">)</span>
                    <span class="p">]</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;disturber&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;baseline&quot;</span>
                <span class="k">else</span> <span class="s2">&quot;baseline&quot;</span>
            <span class="p">),</span>
            <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">disturbance_label_df</span>
    <span class="k">elif</span> <span class="s2">&quot;disturber&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The dataframe does not contain a &#39;disturber&#39; column. &quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="get_available_disturbers"><a class="viewcode-back" href="../../../autoapi/stable_learning_control/utils/eval_robustness/index.html#stable_learning_control.utils.eval_robustness.get_available_disturbers">[docs]</a><span class="k">def</span> <span class="nf">get_available_disturbers</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get all disturbers that are available in the ``stable_learning_control`` package.</span>

<span class="sd">    Returns:</span>
<span class="sd">        list: List with all available disturbers.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">disturber_module</span> <span class="o">=</span> <span class="n">importlib</span><span class="o">.</span><span class="n">import_module</span><span class="p">(</span><span class="s2">&quot;stable_learning_control.disturbers&quot;</span><span class="p">)</span>
    <span class="n">disturber_names</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">name</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getmembers</span><span class="p">(</span><span class="n">disturber_module</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">inspect</span><span class="o">.</span><span class="n">isclass</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">gym</span><span class="o">.</span><span class="n">Wrapper</span><span class="p">)</span>
    <span class="p">]</span>
    <span class="k">return</span> <span class="n">disturber_names</span></div>


<div class="viewcode-block" id="get_available_disturbers_string"><a class="viewcode-back" href="../../../autoapi/stable_learning_control/utils/eval_robustness/index.html#stable_learning_control.utils.eval_robustness.get_available_disturbers_string">[docs]</a><span class="k">def</span> <span class="nf">get_available_disturbers_string</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get a string with all available disturbers that are available in the</span>
<span class="sd">    ``stable_learning_control`` package.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: String with all available disturbers.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">available_disturbers</span> <span class="o">=</span> <span class="n">get_available_disturbers</span><span class="p">()</span>
    <span class="n">str_valid_disturbers</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="k">for</span> <span class="n">disturber_name</span> <span class="ow">in</span> <span class="n">available_disturbers</span><span class="p">:</span>
        <span class="n">str_valid_disturbers</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot; - </span><span class="si">{</span><span class="n">disturber_name</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="n">list_disturbers_msg</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">dedent</span><span class="p">(</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Currently available disturbers in the SLC package are:</span>
<span class="sd">            &quot;&quot;&quot;</span>
        <span class="p">)</span>
        <span class="o">+</span> <span class="n">str_valid_disturbers</span>
        <span class="o">+</span> <span class="n">dedent</span><span class="p">(</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            You can use the &#39;--disturbance_type&#39; argument to specify the disturber and</span>
<span class="sd">            the &#39;--help&#39; argument to get more information about a given disturber.</span>

<span class="sd">            For example:</span>

<span class="sd">                python -m stable_learning_control.run eval_robustness [path/to/output_directory] [disturber] --help</span>
<span class="sd">            &quot;&quot;&quot;</span>  <span class="c1"># noqa: E501</span>
        <span class="p">)</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">list_disturbers_msg</span></div>


<div class="viewcode-block" id="print_available_disturbers"><a class="viewcode-back" href="../../../autoapi/stable_learning_control/utils/eval_robustness/index.html#stable_learning_control.utils.eval_robustness.print_available_disturbers">[docs]</a><span class="k">def</span> <span class="nf">print_available_disturbers</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Print all available disturbers that are available in the</span>
<span class="sd">    ``stable_learning_control`` package.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">available_disturbers_string</span> <span class="o">=</span> <span class="n">get_available_disturbers_string</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">available_disturbers_string</span><span class="p">)</span></div>


<div class="viewcode-block" id="load_disturber"><a class="viewcode-back" href="../../../autoapi/stable_learning_control/utils/eval_robustness/index.html#stable_learning_control.utils.eval_robustness.load_disturber">[docs]</a><span class="k">def</span> <span class="nf">load_disturber</span><span class="p">(</span><span class="n">disturber_id</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Load a given disturber. The disturber name can include an unloaded module in</span>
<span class="sd">    &quot;module:disturber_name&quot; style. If no module is given, the disturber is loaded from</span>
<span class="sd">    the ``stable_learning_control.disturbers`` module.</span>

<span class="sd">    Args:</span>
<span class="sd">        disturber_id (str): The name of the disturber you want to load.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The loaded disturber object.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ModuleNotFoundError: If the given module could not be imported.</span>
<span class="sd">        TypeError: If the given disturber is not a subclass of the :class:`gym.Wrapper`</span>
<span class="sd">            class.</span>
<span class="sd">        AttributeError: If the given disturber does not exist in the given module.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">module</span><span class="p">,</span> <span class="n">disturber_name</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">disturber_id</span><span class="p">)</span> <span class="k">if</span> <span class="s2">&quot;:&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">disturber_id</span> <span class="k">else</span> <span class="n">disturber_id</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="c1"># Load disturber from the given module.</span>
    <span class="k">if</span> <span class="n">module</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># Try to import the module.</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">disturber_module</span> <span class="o">=</span> <span class="n">importlib</span><span class="o">.</span><span class="n">import_module</span><span class="p">(</span><span class="n">module</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ModuleNotFoundError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ModuleNotFoundError</span><span class="p">(</span>
                <span class="n">friendly_err</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">. Disturber retrieval via importing a module failed. &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;Check whether &#39;</span><span class="si">{</span><span class="n">module</span><span class="si">}</span><span class="s2">&#39; contains &#39;</span><span class="si">{</span><span class="n">disturber_name</span><span class="si">}</span><span class="s2">&#39;.&quot;</span>
                <span class="p">)</span>
            <span class="p">)</span> <span class="kn">from</span> <span class="nn">e</span>

        <span class="c1"># Load disturber from the module.</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">disturber</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">disturber_module</span><span class="p">,</span> <span class="n">disturber_name</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">AttributeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span>
                <span class="n">friendly_err</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">. Disturber &#39;</span><span class="si">{</span><span class="n">disturber_name</span><span class="si">}</span><span class="s2">&#39; could not be found in &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;module &#39;</span><span class="si">{</span><span class="n">module</span><span class="si">}</span><span class="s2">&#39;.&quot;</span>
                <span class="p">)</span>
            <span class="p">)</span> <span class="kn">from</span> <span class="nn">e</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Load disturber from the SLC disturbers.</span>
        <span class="n">disturber_module</span> <span class="o">=</span> <span class="n">importlib</span><span class="o">.</span><span class="n">import_module</span><span class="p">(</span><span class="s2">&quot;stable_learning_control.disturbers&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">disturber</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">disturber_module</span><span class="p">,</span> <span class="n">disturber_name</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">AttributeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span>
                <span class="n">friendly_err</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Disturber &#39;</span><span class="si">{</span><span class="n">disturber_name</span><span class="si">}</span><span class="s2">&#39; could not be found in &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;module &#39;</span><span class="si">{</span><span class="n">disturber_module</span><span class="si">}</span><span class="s2">&#39;.</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">get_available_disturbers_string</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>
            <span class="p">)</span> <span class="kn">from</span> <span class="nn">e</span>

    <span class="c1"># Validate whether the disturber is a subclass of the gym.Wrapper class.</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">disturber</span><span class="p">,</span> <span class="n">gym</span><span class="o">.</span><span class="n">Wrapper</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
            <span class="n">friendly_err</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Disturber &#39;</span><span class="si">{</span><span class="n">disturber_name</span><span class="si">}</span><span class="s2">&#39; is not a valid disturber since it &quot;</span>
                <span class="s2">&quot;does not inherit from the &#39;gym.Wrapper&#39; class.&quot;</span>
            <span class="p">)</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">disturber</span></div>


<div class="viewcode-block" id="retrieve_disturber_variants"><a class="viewcode-back" href="../../../autoapi/stable_learning_control/utils/eval_robustness/index.html#stable_learning_control.utils.eval_robustness.retrieve_disturber_variants">[docs]</a><span class="k">def</span> <span class="nf">retrieve_disturber_variants</span><span class="p">(</span><span class="n">disturber_range_dict</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Retrieves all disturber variants from the given disturber configuration</span>
<span class="sd">    dictionary. Variants are created by combining the key values over indexes.</span>

<span class="sd">    Args:</span>
<span class="sd">        disturber_range_dict (dict): The disturber configuration dictionary.</span>

<span class="sd">    Returns:</span>
<span class="sd">        list: List with all disturber variants.</span>

<span class="sd">    Raises:</span>
<span class="sd">        TypeError: Thrown when the values in the disturber configuration variables are</span>
<span class="sd">            not of type ``float``, ``int`` or ``list``.</span>
<span class="sd">        ValueError: Thrown when the values in the disturber configuration variables do</span>
<span class="sd">            not have the same length.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Throw warning if values are not float int or list.</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">list</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">disturber_range_dict</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
        <span class="p">]</span>
    <span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
            <span class="n">friendly_err</span><span class="p">(</span>
                <span class="s2">&quot;All values in the &#39;disturber_range_dict&#39; dictionary should be of type &quot;</span>
                <span class="s2">&quot;&#39;float&#39;, &#39;int&#39; or &#39;list&#39;.&quot;</span>
            <span class="p">)</span>
        <span class="p">)</span>

    <span class="c1"># Convert all values to lists.</span>
    <span class="n">disturber_range_dict</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">key</span><span class="p">:</span> <span class="p">[</span><span class="n">value</span><span class="p">]</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="k">else</span> <span class="n">value</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">disturber_range_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
    <span class="p">}</span>

    <span class="c1"># Throw a warning if the values don&#39;t have the same length.</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">disturber_range_dict</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">disturber_range_dict</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
        <span class="p">]</span>
    <span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="n">friendly_err</span><span class="p">(</span>
                <span class="s2">&quot;All values in the &#39;--disturber_config&#39; dictionary should have the &quot;</span>
                <span class="s2">&quot;same length.&quot;</span>
            <span class="p">)</span>
        <span class="p">)</span>

    <span class="c1"># Get the disturber variants.</span>
    <span class="c1"># NOTE: Combines key values over indexes.</span>
    <span class="n">disturber_variants</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="n">value</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">disturber_range_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
        <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">disturber_range_dict</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="mi">0</span><span class="p">]))</span>
    <span class="p">]</span>

    <span class="k">return</span> <span class="n">disturber_variants</span></div>


<div class="viewcode-block" id="run_disturbed_policy"><a class="viewcode-back" href="../../../autoapi/stable_learning_control/utils/eval_robustness/index.html#stable_learning_control.utils.eval_robustness.run_disturbed_policy">[docs]</a><span class="k">def</span> <span class="nf">run_disturbed_policy</span><span class="p">(</span>
    <span class="n">env</span><span class="p">,</span>
    <span class="n">policy</span><span class="p">,</span>
    <span class="n">disturber</span><span class="p">,</span>
    <span class="n">disturber_config</span><span class="p">,</span>
    <span class="n">include_baseline</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">max_ep_len</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">num_episodes</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
    <span class="n">render</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">deterministic</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">save_result</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">output_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">use_wandb</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">wandb_job_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">wandb_project</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">wandb_group</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">wandb_run_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Evaluates the disturbed policy inside a given gymnasium environment. This</span>
<span class="sd">    function loops to all the disturbances that are specified in the environment and</span>
<span class="sd">    outputs the results of all these episodes as a :obj:pandas.Dataframe`.</span>

<span class="sd">    Args:</span>
<span class="sd">        env (:obj:`gym.env`): The gymnasium environment.</span>
<span class="sd">        policy (Union[tf.keras.Model, torch.nn.Module]): The policy.</span>
<span class="sd">        disturber (obj:`gym.Wrapper`): The disturber you want to use.</span>
<span class="sd">        disturber_config (dict): The disturber configuration dictionary. Contains the</span>
<span class="sd">            variables that you want to pass to the disturber. It sets up the range of</span>
<span class="sd">            disturbances you wish to evaluate.</span>
<span class="sd">        include_baseline (bool): Whether you want to automatically add the baseline</span>
<span class="sd">            (i.e. zero disturbance) when it not present. Defaults to ``True``.</span>
<span class="sd">        max_ep_len (int, optional): The maximum episode length. Defaults to ``None``.</span>
<span class="sd">            Meaning the maximum episode length of the environment is used.</span>
<span class="sd">        num_episodes (int, optional): Number of episodes you want to perform in the</span>
<span class="sd">            environment. Defaults to ``100``.</span>
<span class="sd">        render (bool, optional): Whether you want to render the episode to the screen.</span>
<span class="sd">            Defaults to ``True``.</span>
<span class="sd">        deterministic (bool, optional): Whether you want the action from the policy to</span>
<span class="sd">            be deterministic. Defaults to ``True``.</span>
<span class="sd">        save_result (bool, optional): Whether you want to save the dataframe with the</span>
<span class="sd">            results to disk. Defaults to ``False``.</span>
<span class="sd">        output_dir (str, optional): A directory for saving the diagnostics to. If</span>
<span class="sd">            ``None``, defaults to a temp directory of the form</span>
<span class="sd">            ``/tmp/experiments/somerandomnumber``.</span>
<span class="sd">        use_wandb (bool, optional): Whether to use Weights &amp; Biases for logging.</span>
<span class="sd">            Defaults to ``False``.</span>
<span class="sd">        wandb_job_type (str, optional): The type of job you are running. Defaults</span>
<span class="sd">            to ``None``.</span>
<span class="sd">        wandb_project (str, optional): The name of the Weights &amp; Biases</span>
<span class="sd">            project. Defaults to ``None`` which means that the project name is</span>
<span class="sd">            automatically generated.</span>
<span class="sd">        wandb_group (str, optional): The name of the Weights &amp; Biases group you want</span>
<span class="sd">            to assign the run to. Defaults to ``None``.</span>
<span class="sd">        wandb_run_name (str, optional): The name of the Weights &amp; Biases run. Defaults</span>
<span class="sd">            to ``None`` which means that the run name is automatically generated.</span>

<span class="sd">    Returns:</span>
<span class="sd">        :obj:`pandas.DataFrame`: Dataframe that contains information about all the</span>
<span class="sd">            episodes and disturbances.</span>

<span class="sd">    Raises:</span>
<span class="sd">        AssertionError: Thrown when the environment or policy is not found.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">eval_args</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="nb">locals</span><span class="p">())</span>

    <span class="c1"># Retrieve disturber variants.</span>
    <span class="n">disturber_variants</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">retrieve_disturber_variants</span><span class="p">(</span><span class="n">disturber_config</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">disturber_config</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="k">else</span> <span class="p">[]</span>
    <span class="p">)</span>

    <span class="c1"># Throw error if baseline is disabled and no disturber variants are present.</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">include_baseline</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">disturber_variants</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="n">friendly_err</span><span class="p">(</span>
                <span class="s2">&quot;You disabled the baseline evaluation and no disturber variants are &quot;</span>
                <span class="s2">&quot;present. Please check the &#39;--disturber_config&#39; dictionary and try &quot;</span>
                <span class="s2">&quot;again.&quot;</span>
            <span class="p">)</span>
        <span class="p">)</span>

    <span class="c1"># Let the user know that only the baseline is evaluated and change output dir.</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">disturber_variants</span><span class="p">:</span>
        <span class="n">log_to_std_out</span><span class="p">(</span>
            <span class="p">(</span>
                <span class="s2">&quot;You did not supply a &#39;--disturber_config&#39; dictionary. As a result only &quot;</span>
                <span class="s2">&quot;the baseline will be evaluated.&quot;</span>
            <span class="p">),</span>
            <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;warning&quot;</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="c1"># Setup logger.</span>
    <span class="k">if</span> <span class="n">output_dir</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">output_dir</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
            <span class="n">Path</span><span class="p">(</span><span class="n">output_dir</span><span class="p">)</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span>
                <span class="s2">&quot;eval/</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">convert_to_snake_case</span><span class="p">(</span><span class="n">disturber</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">disturber_variants</span>
                    <span class="k">else</span> <span class="s2">&quot;baseline&quot;</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="p">)</span>
    <span class="n">logger</span> <span class="o">=</span> <span class="n">EpochLogger</span><span class="p">(</span>
        <span class="n">verbose_fmt</span><span class="o">=</span><span class="s2">&quot;table&quot;</span><span class="p">,</span>
        <span class="n">output_dir</span><span class="o">=</span><span class="n">output_dir</span><span class="p">,</span>
        <span class="n">output_fname</span><span class="o">=</span><span class="s2">&quot;eval_statistics.csv&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">assert</span> <span class="n">env</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="n">friendly_err</span><span class="p">(</span>
        <span class="s2">&quot;Environment not found!</span><span class="se">\n\n</span><span class="s2"> It looks like the environment wasn&#39;t saved, and we &quot;</span>
        <span class="s2">&quot;can&#39;t run the agent in it. :( </span><span class="se">\n\n</span><span class="s2"> Check out the documentation page on the &quot;</span>
        <span class="s2">&quot;page on the robustness evaluation utility for how to handle this situation.&quot;</span>
    <span class="p">)</span>
    <span class="k">assert</span> <span class="n">policy</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="n">friendly_err</span><span class="p">(</span>
        <span class="s2">&quot;Policy not found!</span><span class="se">\n\n</span><span class="s2"> It looks like the policy could not be loaded. :( </span><span class="se">\n\n</span><span class="s2"> &quot;</span>
        <span class="s2">&quot;Check out the documentation page on the robustness evaluation utility for how &quot;</span>
        <span class="s2">&quot;to handle this situation.&quot;</span>
    <span class="p">)</span>

    <span class="c1"># Increase action space.</span>
    <span class="c1"># NOTE: Needed to prevent the disturbance from being clipped by the action space.</span>
    <span class="n">env</span><span class="o">.</span><span class="n">unwrapped</span><span class="o">.</span><span class="n">action_space</span><span class="o">.</span><span class="n">high</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="n">np</span><span class="o">.</span><span class="n">finfo</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">unwrapped</span><span class="o">.</span><span class="n">action_space</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span><span class="o">.</span><span class="n">max</span>
            <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">env</span><span class="o">.</span><span class="n">unwrapped</span><span class="o">.</span><span class="n">action_space</span><span class="o">.</span><span class="n">high</span>
        <span class="p">]</span>
    <span class="p">)</span>
    <span class="n">env</span><span class="o">.</span><span class="n">unwrapped</span><span class="o">.</span><span class="n">action_space</span><span class="o">.</span><span class="n">low</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="n">np</span><span class="o">.</span><span class="n">finfo</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">unwrapped</span><span class="o">.</span><span class="n">action_space</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span><span class="o">.</span><span class="n">min</span>
            <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">env</span><span class="o">.</span><span class="n">unwrapped</span><span class="o">.</span><span class="n">action_space</span><span class="o">.</span><span class="n">low</span>
        <span class="p">]</span>
    <span class="p">)</span>

    <span class="c1"># Apply episode length and set render mode.</span>
    <span class="k">if</span> <span class="n">max_ep_len</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">max_ep_len</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">max_ep_len</span> <span class="o">&gt;</span> <span class="n">env</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">_max_episode_steps</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span>
                <span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;You defined your &#39;max_ep_len&#39; to be </span><span class="si">{</span><span class="n">max_ep_len</span><span class="si">}</span><span class="s2"> &quot;</span>
                    <span class="s2">&quot;while the environment &#39;max_episode_steps&#39; is &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">env</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">_max_episode_steps</span><span class="si">}</span><span class="s2">. As a result the environment &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;&#39;max_episode_steps&#39; has been increased to </span><span class="si">{</span><span class="n">max_ep_len</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">),</span>
                <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;warning&quot;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="n">env</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">_max_episode_steps</span> <span class="o">=</span> <span class="n">max_ep_len</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">max_ep_len</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">_max_episode_steps</span>
    <span class="k">if</span> <span class="n">render</span><span class="p">:</span>
        <span class="n">render_modes</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">unwrapped</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;render_modes&quot;</span><span class="p">,</span> <span class="p">[])</span>
        <span class="k">if</span> <span class="n">render_modes</span><span class="p">:</span>
            <span class="n">env</span><span class="o">.</span><span class="n">unwrapped</span><span class="o">.</span><span class="n">render_mode</span> <span class="o">=</span> <span class="s2">&quot;human&quot;</span> <span class="k">if</span> <span class="s2">&quot;human&quot;</span> <span class="ow">in</span> <span class="n">render_modes</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span>
                <span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Nothing was rendered since the &#39;</span><span class="si">{</span><span class="n">get_env_id</span><span class="p">(</span><span class="n">env</span><span class="p">)</span><span class="si">}</span><span class="s2">&#39; &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;environment does not contain a &#39;human&#39; render mode.&quot;</span>
                <span class="p">),</span>
                <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;warning&quot;</span><span class="p">,</span>
            <span class="p">)</span>

    <span class="c1"># Create environment list for each disturbance variant.</span>
    <span class="n">variants_envs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">include_baseline</span><span class="p">:</span>
        <span class="n">variants_envs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">env</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">variant</span> <span class="ow">in</span> <span class="n">disturber_variants</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">disturbance_variant</span> <span class="o">=</span> <span class="n">disturber</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="o">**</span><span class="n">variant</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                    <span class="n">friendly_err</span><span class="p">(</span>
                        <span class="s2">&quot;Something went wrong when trying to initialize the &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="n">disturber</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&#39; disturber with arguments `</span><span class="si">{</span><span class="n">variant</span><span class="si">}</span><span class="s2">`. &quot;</span>
                        <span class="s2">&quot;Please check the disturber arguments supplied in the &quot;</span>
                        <span class="s2">&quot;&#39;disturber_config&#39; dictionary and try again. You can find more &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;information about the &#39;</span><span class="si">{</span><span class="n">disturber</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&#39; disturber &quot;</span>
                        <span class="s2">&quot;through the &#39;--help&#39; flag.&quot;</span>
                    <span class="p">)</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">friendly_err</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
        <span class="n">variants_envs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">disturbance_variant</span><span class="p">)</span>

    <span class="c1"># Setup storage variables.</span>
    <span class="n">path</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;o&quot;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="s2">&quot;r&quot;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="s2">&quot;reference&quot;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="s2">&quot;reference_error&quot;</span><span class="p">:</span> <span class="p">[],</span>
    <span class="p">}</span>
    <span class="n">time</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">variant_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
    <span class="n">variants_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
    <span class="n">ref_found</span><span class="p">,</span> <span class="n">ref_error_found</span><span class="p">,</span> <span class="n">supports_deterministic</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span>
    <span class="n">time_attribute</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">time_step_attribute</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">disturbance_diagnostics</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

    <span class="c1"># Check if environment has time attribute.</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">unwrapped</span><span class="p">,</span> <span class="s2">&quot;time&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">unwrapped</span><span class="p">,</span> <span class="s2">&quot;t&quot;</span><span class="p">):</span>
        <span class="n">time_attribute</span> <span class="o">=</span> <span class="s2">&quot;time&quot;</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">unwrapped</span><span class="p">,</span> <span class="s2">&quot;time&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="s2">&quot;t&quot;</span>
    <span class="k">if</span> <span class="p">(</span>
        <span class="nb">hasattr</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">unwrapped</span><span class="p">,</span> <span class="s2">&quot;dt&quot;</span><span class="p">)</span>
        <span class="ow">or</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">unwrapped</span><span class="p">,</span> <span class="s2">&quot;tau&quot;</span><span class="p">)</span>
        <span class="ow">or</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">unwrapped</span><span class="p">,</span> <span class="s2">&quot;timestep&quot;</span><span class="p">)</span>
        <span class="ow">or</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">unwrapped</span><span class="p">,</span> <span class="s2">&quot;time_step&quot;</span><span class="p">)</span>
    <span class="p">):</span>
        <span class="n">time_step_attribute</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;dt&quot;</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">unwrapped</span><span class="p">,</span> <span class="s2">&quot;dt&quot;</span><span class="p">)</span>
            <span class="k">else</span> <span class="p">(</span>
                <span class="s2">&quot;tau&quot;</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">unwrapped</span><span class="p">,</span> <span class="s2">&quot;tau&quot;</span><span class="p">)</span>
                <span class="k">else</span> <span class="s2">&quot;timestep&quot;</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">unwrapped</span><span class="p">,</span> <span class="s2">&quot;timestep&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="s2">&quot;time_step&quot;</span>
            <span class="p">)</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="n">time_attribute</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">time_step_attribute</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span>
            <span class="p">(</span>
                <span class="s2">&quot;No time attributes (i.e. &#39;time&#39;, &#39;t&#39;, &#39;dt&#39;, &#39;tau&#39;, &#39;timestep&#39;, &quot;</span>
                <span class="s2">&quot;&#39;time_step&#39;) were found on the environment. As a result a time &quot;</span>
                <span class="s2">&quot;step of &#39;1&#39; will be used.&quot;</span>
            <span class="p">),</span>
            <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;warning&quot;</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="c1"># Evaluate each disturbance variant.</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s2">&quot;Performing robustness evaluation...&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;info&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">variant_idx</span><span class="p">,</span> <span class="n">variant_env</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">variants_envs</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">include_baseline</span> <span class="ow">and</span> <span class="n">variant_idx</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s2">&quot;Evaluating baseline...&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;info&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span>
                <span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Evaluating &#39;</span><span class="si">{</span><span class="n">disturber</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&#39; with &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;`</span><span class="si">{</span><span class="n">disturber_variants</span><span class="p">[</span><span class="n">variant_idx</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">` parameters...&quot;</span>
                <span class="p">),</span>
                <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;info&quot;</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="c1"># Perform episodes.</span>
        <span class="n">o</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">variant_env</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
        <span class="n">r</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">ep_ret</span><span class="p">,</span> <span class="n">ep_len</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="n">num_episodes</span><span class="p">:</span>
            <span class="c1"># Retrieve action.</span>
            <span class="k">if</span> <span class="n">deterministic</span> <span class="ow">and</span> <span class="n">supports_deterministic</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">a</span> <span class="o">=</span> <span class="n">policy</span><span class="o">.</span><span class="n">get_action</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">deterministic</span><span class="o">=</span><span class="n">deterministic</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                    <span class="n">supports_deterministic</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span>
                        <span class="s2">&quot;Input argument &#39;deterministic&#39; ignored as the algorithm does &quot;</span>
                        <span class="s2">&quot;not support deterministic actions. This is only supported for &quot;</span>
                        <span class="s2">&quot;gaussian  algorithms.&quot;</span><span class="p">,</span>
                        <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;warning&quot;</span><span class="p">,</span>
                    <span class="p">)</span>
                    <span class="n">a</span> <span class="o">=</span> <span class="n">policy</span><span class="o">.</span><span class="n">get_action</span><span class="p">(</span><span class="n">o</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">a</span> <span class="o">=</span> <span class="n">policy</span><span class="o">.</span><span class="n">get_action</span><span class="p">(</span><span class="n">o</span><span class="p">)</span>

            <span class="c1"># Perform action in the environment and store result.</span>
            <span class="n">o</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">truncated</span><span class="p">,</span> <span class="n">info</span> <span class="o">=</span> <span class="n">variant_env</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>

            <span class="c1"># Track time.</span>
            <span class="n">time</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">time_attribute</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">t</span> <span class="o">=</span> <span class="n">variant_env</span><span class="o">.</span><span class="n">unwrapped</span><span class="o">.</span><span class="fm">__getattribute__</span><span class="p">(</span><span class="n">time_attribute</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">time_step_attribute</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">t</span> <span class="o">+=</span> <span class="n">variant_env</span><span class="o">.</span><span class="n">unwrapped</span><span class="o">.</span><span class="fm">__getattribute__</span><span class="p">(</span><span class="n">time_step_attribute</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">t</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="c1"># Store step information.</span>
            <span class="n">ep_ret</span> <span class="o">+=</span> <span class="n">r</span>
            <span class="n">ep_len</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">path</span><span class="p">[</span><span class="s2">&quot;o&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">o</span><span class="p">)</span>
            <span class="n">path</span><span class="p">[</span><span class="s2">&quot;r&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ref_found</span> <span class="ow">and</span> <span class="s2">&quot;reference&quot;</span> <span class="ow">in</span> <span class="n">info</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">path</span><span class="p">[</span><span class="s2">&quot;reference&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="s2">&quot;reference&quot;</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">ref_found</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span>
                        <span class="p">(</span>
                            <span class="s2">&quot;No &#39;reference&#39; found in info dictionary. Please add the &quot;</span>
                            <span class="s2">&quot;reference to the info dictionary of the environment if &quot;</span>
                            <span class="s2">&quot;you want to have it show up in the evaluation results.&quot;</span>
                        <span class="p">),</span>
                        <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;warning&quot;</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="n">ref_found</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="n">ref_error_found</span> <span class="ow">and</span> <span class="s2">&quot;reference_error&quot;</span> <span class="ow">in</span> <span class="n">info</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">path</span><span class="p">[</span><span class="s2">&quot;reference_error&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="s2">&quot;reference_error&quot;</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">ref_error_found</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span>
                        <span class="p">(</span>
                            <span class="s2">&quot;No &#39;reference_error&#39; found in info dictionary. Please add &quot;</span>
                            <span class="s2">&quot;the reference to the info dictionary of the environment &quot;</span>
                            <span class="s2">&quot;if you want to have it show up in the evaluation results.&quot;</span>
                        <span class="p">),</span>
                        <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;warning&quot;</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="n">ref_error_found</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="c1"># Store episode information.</span>
            <span class="k">if</span> <span class="n">d</span> <span class="ow">or</span> <span class="n">truncated</span><span class="p">:</span>
                <span class="n">died</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">truncated</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">store</span><span class="p">(</span><span class="n">EpRet</span><span class="o">=</span><span class="n">ep_ret</span><span class="p">,</span> <span class="n">EpLen</span><span class="o">=</span><span class="n">ep_len</span><span class="p">,</span> <span class="n">DeathRate</span><span class="o">=</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">died</span><span class="p">)))</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span>
                    <span class="s2">&quot;Episode </span><span class="si">%d</span><span class="s2"> </span><span class="se">\t</span><span class="s2"> EpRet </span><span class="si">%.3f</span><span class="s2"> </span><span class="se">\t</span><span class="s2"> EpLen </span><span class="si">%d</span><span class="s2"> </span><span class="se">\t</span><span class="s2"> Died </span><span class="si">%s</span><span class="s2">&quot;</span>
                    <span class="o">%</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">ep_ret</span><span class="p">,</span> <span class="n">ep_len</span><span class="p">,</span> <span class="n">died</span><span class="p">)</span>
                <span class="p">)</span>

                <span class="c1"># Store episode data.</span>
                <span class="n">episode_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">ep_len</span><span class="p">),</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;step&quot;</span><span class="p">])</span>
                <span class="n">episode_df</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">episode_df</span><span class="o">.</span><span class="n">columns</span><span class="p">),</span> <span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="n">time</span><span class="p">)</span>
                <span class="n">episode_df</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">episode_df</span><span class="o">.</span><span class="n">columns</span><span class="p">),</span> <span class="s2">&quot;episode&quot;</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">path</span><span class="p">[</span><span class="s2">&quot;o&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
                    <span class="n">episode_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
                        <span class="p">[</span>
                            <span class="n">episode_df</span><span class="p">,</span>
                            <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
                                <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">path</span><span class="p">[</span><span class="s2">&quot;o&quot;</span><span class="p">]),</span>
                                <span class="n">columns</span><span class="o">=</span><span class="p">[</span>
                                    <span class="sa">f</span><span class="s2">&quot;observation_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span>
                                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">path</span><span class="p">[</span><span class="s2">&quot;o&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
                                <span class="p">],</span>
                            <span class="p">),</span>
                        <span class="p">],</span>
                        <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">episode_df</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">episode_df</span><span class="o">.</span><span class="n">columns</span><span class="p">),</span> <span class="s2">&quot;observation&quot;</span><span class="p">,</span> <span class="n">path</span><span class="p">[</span><span class="s2">&quot;o&quot;</span><span class="p">])</span>
                <span class="n">episode_df</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">episode_df</span><span class="o">.</span><span class="n">columns</span><span class="p">),</span> <span class="s2">&quot;cost&quot;</span><span class="p">,</span> <span class="n">path</span><span class="p">[</span><span class="s2">&quot;r&quot;</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">ref_found</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">path</span><span class="p">[</span><span class="s2">&quot;reference&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
                        <span class="n">episode_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
                            <span class="p">[</span>
                                <span class="n">episode_df</span><span class="p">,</span>
                                <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
                                    <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">path</span><span class="p">[</span><span class="s2">&quot;reference&quot;</span><span class="p">]),</span>
                                    <span class="n">columns</span><span class="o">=</span><span class="p">[</span>
                                        <span class="sa">f</span><span class="s2">&quot;reference_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span>
                                        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">path</span><span class="p">[</span><span class="s2">&quot;reference&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
                                    <span class="p">],</span>
                                <span class="p">),</span>
                            <span class="p">],</span>
                            <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                        <span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">episode_df</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span>
                            <span class="nb">len</span><span class="p">(</span><span class="n">episode_df</span><span class="o">.</span><span class="n">columns</span><span class="p">),</span> <span class="s2">&quot;reference&quot;</span><span class="p">,</span> <span class="n">path</span><span class="p">[</span><span class="s2">&quot;reference&quot;</span><span class="p">]</span>
                        <span class="p">)</span>
                <span class="k">if</span> <span class="n">ref_error_found</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">path</span><span class="p">[</span><span class="s2">&quot;reference_error&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
                        <span class="n">episode_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
                            <span class="p">[</span>
                                <span class="n">episode_df</span><span class="p">,</span>
                                <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
                                    <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">path</span><span class="p">[</span><span class="s2">&quot;reference_error&quot;</span><span class="p">]),</span>
                                    <span class="n">columns</span><span class="o">=</span><span class="p">[</span>
                                        <span class="sa">f</span><span class="s2">&quot;reference_error_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span>
                                        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span>
                                            <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">path</span><span class="p">[</span><span class="s2">&quot;reference_error&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span>
                                        <span class="p">)</span>
                                    <span class="p">],</span>
                                <span class="p">),</span>
                            <span class="p">],</span>
                            <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                        <span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">episode_df</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span>
                            <span class="nb">len</span><span class="p">(</span><span class="n">episode_df</span><span class="o">.</span><span class="n">columns</span><span class="p">),</span>
                            <span class="s2">&quot;reference_error&quot;</span><span class="p">,</span>
                            <span class="n">path</span><span class="p">[</span><span class="s2">&quot;reference_error&quot;</span><span class="p">],</span>
                        <span class="p">)</span>
                <span class="n">variant_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
                    <span class="p">[</span><span class="n">variant_df</span><span class="p">,</span> <span class="n">episode_df</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span>
                <span class="p">)</span>

                <span class="c1"># Reset env, episode storage buckets and increment episode counter.</span>
                <span class="n">o</span><span class="p">,</span> <span class="n">info</span> <span class="o">=</span> <span class="n">variant_env</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
                <span class="n">r</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">ep_ret</span><span class="p">,</span> <span class="n">ep_len</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span>
                <span class="n">path</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s2">&quot;o&quot;</span><span class="p">:</span> <span class="p">[],</span>
                    <span class="s2">&quot;r&quot;</span><span class="p">:</span> <span class="p">[],</span>
                    <span class="s2">&quot;reference&quot;</span><span class="p">:</span> <span class="p">[],</span>
                    <span class="s2">&quot;reference_error&quot;</span><span class="p">:</span> <span class="p">[],</span>
                <span class="p">}</span>
                <span class="n">time</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Print variant diagnostics.</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">log_tabular</span><span class="p">(</span>
            <span class="s2">&quot;Disturber&quot;</span><span class="p">,</span>
            <span class="s2">&quot;baseline&quot;</span> <span class="k">if</span> <span class="n">include_baseline</span> <span class="ow">and</span> <span class="n">variant_idx</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">disturber</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">disturber_variants</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">var_name</span><span class="p">,</span> <span class="n">var_value</span> <span class="ow">in</span> <span class="n">disturber_variants</span><span class="p">[</span>
                <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">variant_idx</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="n">include_baseline</span> <span class="k">else</span> <span class="n">variant_idx</span>
            <span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">var_value</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">var_value_i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">var_value</span><span class="p">):</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">log_tabular</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;Disturber_</span><span class="si">{</span><span class="n">var_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                            <span class="p">(</span>
                                <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
                                <span class="k">if</span> <span class="n">include_baseline</span> <span class="ow">and</span> <span class="n">variant_idx</span> <span class="o">==</span> <span class="mi">0</span>
                                <span class="k">else</span> <span class="n">var_value_i</span>
                            <span class="p">),</span>
                        <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">log_tabular</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Disturber_</span><span class="si">{</span><span class="n">var_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="k">if</span> <span class="n">include_baseline</span> <span class="ow">and</span> <span class="n">variant_idx</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">var_value</span><span class="p">,</span>
                    <span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">log_tabular</span><span class="p">(</span><span class="s2">&quot;EpRet&quot;</span><span class="p">,</span> <span class="n">with_min_and_max</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">log_tabular</span><span class="p">(</span><span class="s2">&quot;EpLen&quot;</span><span class="p">,</span> <span class="n">average_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">log_tabular</span><span class="p">(</span><span class="s2">&quot;DeathRate&quot;</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="n">disturbance_diagnostics</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="n">disturbance_diagnostics</span><span class="p">,</span>
                <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">log_current_row</span><span class="p">,</span>
                    <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="n">variant_idx</span><span class="p">],</span>
                <span class="p">),</span>
            <span class="p">],</span>
            <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>  <span class="c1"># Store variant diagnostics in dataframe.</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">dump_tabular</span><span class="p">()</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

        <span class="c1"># Add disturbance information to the robustness evaluation dataframe.</span>
        <span class="n">variant_df</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span>
            <span class="nb">len</span><span class="p">(</span><span class="n">variant_df</span><span class="o">.</span><span class="n">columns</span><span class="p">),</span>
            <span class="s2">&quot;disturber&quot;</span><span class="p">,</span>
            <span class="s2">&quot;baseline&quot;</span> <span class="k">if</span> <span class="n">include_baseline</span> <span class="ow">and</span> <span class="n">variant_idx</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">disturber</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">disturber_variants</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">var_name</span><span class="p">,</span> <span class="n">var_value</span> <span class="ow">in</span> <span class="n">disturber_variants</span><span class="p">[</span>
                <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">variant_idx</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="n">include_baseline</span> <span class="k">else</span> <span class="n">variant_idx</span>
            <span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">var_value</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">var_value_i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">var_value</span><span class="p">):</span>
                        <span class="n">variant_df</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span>
                            <span class="nb">len</span><span class="p">(</span><span class="n">variant_df</span><span class="o">.</span><span class="n">columns</span><span class="p">),</span>
                            <span class="sa">f</span><span class="s2">&quot;disturber_</span><span class="si">{</span><span class="n">var_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                            <span class="p">(</span>
                                <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
                                <span class="k">if</span> <span class="n">include_baseline</span> <span class="ow">and</span> <span class="n">variant_idx</span> <span class="o">==</span> <span class="mi">0</span>
                                <span class="k">else</span> <span class="n">var_value_i</span>
                            <span class="p">),</span>
                        <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">variant_df</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span>
                        <span class="nb">len</span><span class="p">(</span><span class="n">variant_df</span><span class="o">.</span><span class="n">columns</span><span class="p">),</span>
                        <span class="sa">f</span><span class="s2">&quot;disturber_</span><span class="si">{</span><span class="n">var_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="k">if</span> <span class="n">include_baseline</span> <span class="ow">and</span> <span class="n">variant_idx</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">var_value</span><span class="p">,</span>
                    <span class="p">)</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span>
            <span class="n">variant_env</span><span class="p">,</span> <span class="s2">&quot;disturbance_label&quot;</span>
        <span class="p">):</span>  <span class="c1"># NOTE: Add disturbance label if available in the environment.</span>
            <span class="n">variant_df</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span>
                <span class="nb">len</span><span class="p">(</span><span class="n">variant_df</span><span class="o">.</span><span class="n">columns</span><span class="p">),</span>
                <span class="s2">&quot;disturbance_label&quot;</span><span class="p">,</span>
                <span class="n">variant_env</span><span class="o">.</span><span class="n">disturbance_label</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="n">variants_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">variants_df</span><span class="p">,</span> <span class="n">variant_df</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Reset variant storage buckets.</span>
        <span class="n">variant_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

    <span class="c1"># Save robustness evaluation dataframe and return it to the user.</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s2">&quot;Saving robustness evaluation dataframe...&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;info&quot;</span><span class="p">)</span>
    <span class="n">results_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">logger</span><span class="o">.</span><span class="n">output_dir</span><span class="p">)</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="s2">&quot;eval_results.csv&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">save_result</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Saving robustness evaluation results to path: </span><span class="si">{</span><span class="n">results_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;info&quot;</span>
        <span class="p">)</span>
        <span class="n">variants_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">results_path</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s2">&quot;Robustness evaluation dataframe saved.&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;info&quot;</span><span class="p">)</span>

    <span class="c1"># Log robustness evaluation results to Weights &amp; Biases.</span>
    <span class="k">if</span> <span class="n">use_wandb</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s2">&quot;Storing robustness evaluation results in Weights &amp; Biases...&quot;</span><span class="p">)</span>
        <span class="kn">import</span> <span class="nn">wandb</span>

        <span class="c1"># Initialize Weights &amp; Biases if not already initialized.</span>
        <span class="k">if</span> <span class="n">wandb</span><span class="o">.</span><span class="n">run</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">wandb</span><span class="o">.</span><span class="n">init</span><span class="p">(</span>
                <span class="n">project</span><span class="o">=</span><span class="n">wandb_project</span><span class="p">,</span>
                <span class="n">group</span><span class="o">=</span><span class="n">wandb_group</span><span class="p">,</span>
                <span class="n">job_type</span><span class="o">=</span><span class="n">wandb_job_type</span><span class="p">,</span>
                <span class="n">name</span><span class="o">=</span><span class="n">wandb_run_name</span><span class="p">,</span>
                <span class="n">config</span><span class="o">=</span><span class="n">convert_to_wandb_config</span><span class="p">(</span><span class="n">eval_args</span><span class="p">),</span>
            <span class="p">)</span>

        <span class="c1"># Create disturbance diagnostics table and bar plots.</span>
        <span class="n">wandb</span><span class="o">.</span><span class="n">log</span><span class="p">({</span><span class="s2">&quot;disturbance_diagnostics&quot;</span><span class="p">:</span> <span class="n">disturbance_diagnostics</span><span class="p">})</span>
        <span class="n">bar_plots</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">column_name</span> <span class="ow">in</span> <span class="n">disturbance_diagnostics</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">column_name</span> <span class="o">==</span> <span class="s2">&quot;Disturber&quot;</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">bar_plots</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">column_name</span><span class="si">}</span><span class="s2">_bar&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">wandb</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span>
                <span class="n">wandb</span><span class="o">.</span><span class="n">Table</span><span class="p">(</span>
                    <span class="n">data</span><span class="o">=</span><span class="n">disturbance_diagnostics</span><span class="p">[[</span><span class="s2">&quot;Disturber&quot;</span><span class="p">,</span> <span class="n">column_name</span><span class="p">]],</span>
                    <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Disturber&quot;</span><span class="p">,</span> <span class="n">column_name</span><span class="p">],</span>
                <span class="p">),</span>
                <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Disturber&quot;</span><span class="p">,</span>
                <span class="n">value</span><span class="o">=</span><span class="n">column_name</span><span class="p">,</span>
                <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">column_name</span><span class="si">}</span><span class="s2"> per disturbance&quot;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="n">wandb</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">bar_plots</span><span class="p">)</span>

        <span class="c1"># Store robustness evaluation dataframe as artifact.</span>
        <span class="n">eval_results_artifact</span> <span class="o">=</span> <span class="n">wandb</span><span class="o">.</span><span class="n">Artifact</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;robustness_evaluation_results&quot;</span><span class="p">,</span>
            <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;dataframe&quot;</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Contains the results of the robustness evaluation runs.&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">eval_results_artifact</span><span class="o">.</span><span class="n">add_file</span><span class="p">(</span><span class="n">results_path</span><span class="p">)</span>
        <span class="n">wandb</span><span class="o">.</span><span class="n">log_artifact</span><span class="p">(</span><span class="n">eval_results_artifact</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s2">&quot;Robustness evaluation results stored in Weights &amp; Biases.&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">variants_df</span></div>


<div class="viewcode-block" id="plot_robustness_results"><a class="viewcode-back" href="../../../autoapi/stable_learning_control/utils/eval_robustness/index.html#stable_learning_control.utils.eval_robustness.plot_robustness_results">[docs]</a><span class="k">def</span> <span class="nf">plot_robustness_results</span><span class="p">(</span>
    <span class="n">dataframe</span><span class="p">,</span>
    <span class="n">observations</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">references</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">reference_errors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">absolute_reference_errors</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">merge_reference_errors</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">use_subplots</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">use_time</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">save_plots</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">font_scale</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span>
    <span class="n">figs_fmt</span><span class="o">=</span><span class="s2">&quot;pdf&quot;</span><span class="p">,</span>
    <span class="n">output_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">use_wandb</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">wandb_job_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">wandb_project</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">wandb_group</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">wandb_run_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Creates several useful plots out of a robustness evaluation dataframe that was</span>
<span class="sd">    collected in the :meth:`run_disturbed_policy` method.</span>

<span class="sd">    Args:</span>
<span class="sd">        dataframe (pandas.DataFrame): The data frame that contains the robustness</span>
<span class="sd">            evaluation information information.</span>
<span class="sd">        observations (list): The observations you want to show in the observations plot.</span>
<span class="sd">            By default for clarity only the first 6 observations are shown.</span>
<span class="sd">        references (list): The references you want to show in the reference plot. By</span>
<span class="sd">            default for clarity only the first references is shown.</span>
<span class="sd">        reference_errors (list): The reference errors you want to show in the reference</span>
<span class="sd">            error plot. By default for clarity only the first reference error is shown.</span>
<span class="sd">        absolute_reference_errors (bool): Whether you want to plot the absolute</span>
<span class="sd">            reference errors instead of relative reference errors. Defaults to</span>
<span class="sd">            ``False``.</span>
<span class="sd">        merge_reference_errors (bool): Whether you want to merge the reference errors</span>
<span class="sd">            into one reference error. Defaults to ``False``.</span>
<span class="sd">        use_subplots (bool): Whether you want to use subplots instead of separate</span>
<span class="sd">            figures. Defaults to ``False``.</span>
<span class="sd">        use_time (bool): Whether you want to use the time as the x-axis. Defaults to</span>
<span class="sd">            ``False``.</span>
<span class="sd">        save_plots (bool): Whether you want to save the created plots to disk. Defaults</span>
<span class="sd">            to ``False``.</span>
<span class="sd">        font_scale (int): The font scale you want to use for the plot text. Defaults to</span>
<span class="sd">            ``1.5``.</span>
<span class="sd">        figs_fmt (str, optional): In which format you want to save the plots. Defaults</span>
<span class="sd">            to ``pdf``.</span>
<span class="sd">        output_dir (str, optional):The directory where you want to save the output</span>
<span class="sd">            figures to. If ``None``, defaults to a temp directory of the form</span>
<span class="sd">            ``/tmp/experiments/somerandomnumber``.</span>
<span class="sd">        use_wandb (bool, optional): Whether to use Weights &amp; Biases for logging.</span>
<span class="sd">            Defaults to ``False``.</span>
<span class="sd">        wandb_job_type (str, optional): The type of job you are running. Defaults</span>
<span class="sd">            to ``None``.</span>
<span class="sd">        wandb_project (str, optional): The name of the Weights &amp; Biases</span>
<span class="sd">            project. Defaults to ``None`` which means that the project name is</span>
<span class="sd">            automatically generated.</span>
<span class="sd">        wandb_group (str, optional): The name of the Weights &amp; Biases group you want</span>
<span class="sd">            to assign the run to. Defaults to ``None``.</span>
<span class="sd">        wandb_run_name (str, optional): The name of the Weights &amp; Biases run. Defaults</span>
<span class="sd">            to ``None`` which means that the run name is automatically generated.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Retrieve disturbances and disturber name from dataframe.</span>
    <span class="n">dataframe</span><span class="p">[</span><span class="s2">&quot;disturbance_label&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">add_disturbance_label_column</span><span class="p">(</span><span class="n">dataframe</span><span class="p">)</span>
    <span class="n">disturber_name</span> <span class="o">=</span> <span class="n">dataframe</span><span class="p">[</span><span class="s2">&quot;disturber&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="c1"># Setup logger, x-axis variable and output directory.</span>
    <span class="k">if</span> <span class="n">output_dir</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">output_dir</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
            <span class="n">Path</span><span class="p">(</span><span class="n">output_dir</span><span class="p">)</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span>
                <span class="s2">&quot;eval/</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">convert_to_snake_case</span><span class="p">(</span><span class="n">disturber</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">disturber_name</span> <span class="o">!=</span> <span class="s2">&quot;baseline&quot;</span>
                    <span class="k">else</span> <span class="s2">&quot;baseline&quot;</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="p">)</span>
    <span class="n">logger</span> <span class="o">=</span> <span class="n">EpochLogger</span><span class="p">(</span>
        <span class="n">output_dir</span><span class="o">=</span><span class="n">output_dir</span><span class="p">,</span>
        <span class="n">output_dir_exists_warning</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">x_axis_var</span> <span class="o">=</span> <span class="s2">&quot;time&quot;</span> <span class="k">if</span> <span class="n">use_time</span> <span class="k">else</span> <span class="s2">&quot;step&quot;</span>

    <span class="c1"># Create a dictionary to store all plots.</span>
    <span class="n">figs</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;observation&quot;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="s2">&quot;cost&quot;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="s2">&quot;reference_error&quot;</span><span class="p">:</span> <span class="p">[],</span>
    <span class="p">}</span>

    <span class="c1"># Absolute reference errors if requested.</span>
    <span class="k">if</span> <span class="n">absolute_reference_errors</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">col</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;reference_error_&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">col</span> <span class="o">==</span> <span class="s2">&quot;reference_error&quot;</span><span class="p">:</span>
                <span class="n">dataframe</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">dataframe</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span>

    <span class="c1"># Merge reference errors if requested.</span>
    <span class="k">if</span> <span class="n">merge_reference_errors</span><span class="p">:</span>
        <span class="k">if</span> <span class="s2">&quot;reference_error&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="n">dataframe</span><span class="p">[</span><span class="s2">&quot;reference_error&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dataframe</span><span class="p">[</span>
                <span class="p">[</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">col</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;reference_error_&quot;</span><span class="p">)]</span>
            <span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">dataframe</span> <span class="o">=</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="n">col</span>
                    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">columns</span>
                    <span class="k">if</span> <span class="n">col</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;reference_error_&quot;</span><span class="p">)</span>
                <span class="p">],</span>
                <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span>
                <span class="s2">&quot;Only one reference error present in dataframe, skipping merging...&quot;</span><span class="p">,</span>
                <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;warn&quot;</span><span class="p">,</span>
            <span class="p">)</span>

    <span class="c1"># Initialize Seaborn style and font scale.</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s2">&quot;Showing robustness evaluation plots...&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;info&quot;</span><span class="p">)</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="s2">&quot;darkgrid&quot;</span><span class="p">,</span> <span class="n">font_scale</span><span class="o">=</span><span class="n">font_scale</span><span class="p">)</span>

    <span class="c1"># Retrieve available observations, references and reference errors.</span>
    <span class="n">available_obs</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="s2">&quot;observation&quot;</span> <span class="ow">in</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">columns</span>
        <span class="k">else</span> <span class="p">[</span>
            <span class="nb">int</span><span class="p">(</span><span class="n">col</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;observation_&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">columns</span>
            <span class="k">if</span> <span class="n">col</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;observation_&quot;</span><span class="p">)</span>
        <span class="p">]</span>
    <span class="p">)</span>
    <span class="n">available_refs</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="s2">&quot;reference&quot;</span> <span class="ow">in</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">columns</span>
        <span class="k">else</span> <span class="p">[</span>
            <span class="nb">int</span><span class="p">(</span><span class="n">col</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;reference_&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">columns</span>
            <span class="k">if</span> <span class="n">col</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;reference_&quot;</span><span class="p">)</span>
            <span class="ow">and</span> <span class="ow">not</span> <span class="n">col</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;reference_&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;error&quot;</span><span class="p">)</span>
        <span class="p">]</span>
    <span class="p">)</span>
    <span class="n">available_ref_errors</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="s2">&quot;reference_error&quot;</span> <span class="ow">in</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">columns</span>
        <span class="k">else</span> <span class="p">[</span>
            <span class="nb">int</span><span class="p">(</span><span class="n">col</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;reference_error_&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">columns</span>
            <span class="k">if</span> <span class="n">col</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;reference_error_&quot;</span><span class="p">)</span>
        <span class="p">]</span>
    <span class="p">)</span>

    <span class="c1"># Filter observations if requested.</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">available_obs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">observations</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Validate requested observations.</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">([</span><span class="n">obs</span><span class="o">.</span><span class="n">isdigit</span><span class="p">()</span> <span class="k">for</span> <span class="n">obs</span> <span class="ow">in</span> <span class="n">observations</span><span class="p">]):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;Observations must be a list of integers. Please check your input.&quot;</span>
                <span class="p">)</span>
            <span class="n">observations</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">obs</span><span class="p">)</span> <span class="k">for</span> <span class="n">obs</span> <span class="ow">in</span> <span class="n">observations</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">any</span><span class="p">([</span><span class="n">obs</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">obs</span> <span class="ow">in</span> <span class="n">observations</span><span class="p">]):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;Observations must be a list of integers greater than &#39;0&#39;. Please &quot;</span>
                    <span class="s2">&quot;check your input.&quot;</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="nb">any</span><span class="p">([</span><span class="n">obs</span> <span class="o">&gt;</span> <span class="nb">max</span><span class="p">(</span><span class="n">available_obs</span><span class="p">)</span> <span class="k">for</span> <span class="n">obs</span> <span class="ow">in</span> <span class="n">observations</span><span class="p">]):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Observations must be a list of integers smaller than or equal to &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="nb">max</span><span class="p">(</span><span class="n">available_obs</span><span class="p">)</span><span class="si">}</span><span class="s2">&#39;. Please check your input.&quot;</span>
                <span class="p">)</span>

            <span class="c1"># Remove observation columns that are not requested.</span>
            <span class="k">if</span> <span class="s2">&quot;observation&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                <span class="n">unwanted_obs</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="n">col</span>
                    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">columns</span>
                    <span class="k">if</span> <span class="n">col</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;observation_&quot;</span><span class="p">)</span>
                    <span class="ow">and</span> <span class="nb">int</span><span class="p">(</span><span class="n">col</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;observation_&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">observations</span>
                <span class="p">]</span>
            <span class="k">elif</span> <span class="s2">&quot;observation&quot;</span> <span class="ow">in</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                <span class="n">unwanted_obs</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;observation&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">observations</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="p">[]</span>
            <span class="n">dataframe</span> <span class="o">=</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">unwanted_obs</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">available_obs</span> <span class="o">=</span> <span class="n">observations</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># Show only the first 6 observations by default.</span>
            <span class="n">available_obs</span> <span class="o">=</span> <span class="n">available_obs</span><span class="p">[:</span><span class="mi">6</span><span class="p">]</span>

    <span class="c1"># Filter references if requested.</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">available_refs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">references</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Validate requested references.</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">([</span><span class="n">ref</span><span class="o">.</span><span class="n">isdigit</span><span class="p">()</span> <span class="k">for</span> <span class="n">ref</span> <span class="ow">in</span> <span class="n">references</span><span class="p">]):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;References must be a list of integers. Please check your input.&quot;</span>
                <span class="p">)</span>
            <span class="n">references</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">ref</span><span class="p">)</span> <span class="k">for</span> <span class="n">ref</span> <span class="ow">in</span> <span class="n">references</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">any</span><span class="p">([</span><span class="n">ref</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">ref</span> <span class="ow">in</span> <span class="n">references</span><span class="p">]):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;References must be a list of integers greater than &#39;0&#39;. Please &quot;</span>
                    <span class="s2">&quot;check your input.&quot;</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="nb">any</span><span class="p">([</span><span class="n">ref</span> <span class="o">&gt;</span> <span class="nb">max</span><span class="p">(</span><span class="n">available_refs</span><span class="p">)</span> <span class="k">for</span> <span class="n">ref</span> <span class="ow">in</span> <span class="n">references</span><span class="p">]):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;References must be a list of integers smaller than or equal to &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="nb">max</span><span class="p">(</span><span class="n">available_refs</span><span class="p">)</span><span class="si">}</span><span class="s2">&#39;. Please check your input.&quot;</span>
                <span class="p">)</span>

            <span class="c1"># Remove reference columns that are not requested.</span>
            <span class="k">if</span> <span class="s2">&quot;reference&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                <span class="n">unwanted_refs</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="n">col</span>
                    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">columns</span>
                    <span class="k">if</span> <span class="n">col</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;reference_&quot;</span><span class="p">)</span>
                    <span class="ow">and</span> <span class="ow">not</span> <span class="n">col</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;reference_&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;error&quot;</span><span class="p">)</span>
                    <span class="ow">and</span> <span class="nb">int</span><span class="p">(</span><span class="n">col</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;reference_&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">references</span>
                <span class="p">]</span>
            <span class="k">elif</span> <span class="s2">&quot;reference&quot;</span> <span class="ow">in</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                <span class="n">unwanted_refs</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;reference&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">references</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="p">[]</span>
            <span class="n">dataframe</span> <span class="o">=</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">unwanted_refs</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">available_refs</span> <span class="o">=</span> <span class="n">references</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># Show only the first 6 references by default.</span>
            <span class="n">available_refs</span> <span class="o">=</span> <span class="n">available_refs</span><span class="p">[:</span><span class="mi">6</span><span class="p">]</span>

    <span class="c1"># Filter reference errors if requested.</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">available_ref_errors</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">reference_errors</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Validate requested reference errors.</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">([</span><span class="n">ref_err</span><span class="o">.</span><span class="n">isdigit</span><span class="p">()</span> <span class="k">for</span> <span class="n">ref_err</span> <span class="ow">in</span> <span class="n">reference_errors</span><span class="p">]):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;Reference errors must be a list of integers. Please check your &quot;</span>
                    <span class="s2">&quot;input.&quot;</span>
                <span class="p">)</span>
            <span class="n">reference_errors</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">ref_err</span><span class="p">)</span> <span class="k">for</span> <span class="n">ref_err</span> <span class="ow">in</span> <span class="n">reference_errors</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">any</span><span class="p">([</span><span class="n">ref_err</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">ref_err</span> <span class="ow">in</span> <span class="n">reference_errors</span><span class="p">]):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;Reference errors must be a list of integers greater than &#39;0&#39;. &quot;</span>
                    <span class="s2">&quot;Please check your input.&quot;</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="nb">any</span><span class="p">(</span>
                <span class="p">[</span><span class="n">ref_err</span> <span class="o">&gt;</span> <span class="nb">max</span><span class="p">(</span><span class="n">available_ref_errors</span><span class="p">)</span> <span class="k">for</span> <span class="n">ref_err</span> <span class="ow">in</span> <span class="n">reference_errors</span><span class="p">]</span>
            <span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Reference errors must be a list of integers smaller than or &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;equal to &#39;</span><span class="si">{</span><span class="nb">max</span><span class="p">(</span><span class="n">available_ref_errors</span><span class="p">)</span><span class="si">}</span><span class="s2">&#39;. Please check your &quot;</span>
                    <span class="s2">&quot;input.&quot;</span>
                <span class="p">)</span>

            <span class="c1"># Remove reference error columns that are not requested.</span>
            <span class="k">if</span> <span class="s2">&quot;reference_error&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                <span class="n">unwanted_ref_errors</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="n">col</span>
                    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">columns</span>
                    <span class="k">if</span> <span class="n">col</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;reference_error_&quot;</span><span class="p">)</span>
                    <span class="ow">and</span> <span class="nb">int</span><span class="p">(</span><span class="n">col</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;reference_error_&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">reference_errors</span>
                <span class="p">]</span>
            <span class="k">elif</span> <span class="s2">&quot;reference_error&quot;</span> <span class="ow">in</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                <span class="n">unwanted_ref_errors</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="p">[</span><span class="s2">&quot;reference_error&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">reference_errors</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="p">[]</span>
                <span class="p">)</span>
            <span class="n">dataframe</span> <span class="o">=</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">unwanted_ref_errors</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">available_ref_errors</span> <span class="o">=</span> <span class="n">reference_errors</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">available_ref_errors</span> <span class="o">=</span> <span class="n">available_ref_errors</span><span class="p">[:</span><span class="mi">6</span><span class="p">]</span>

    <span class="c1"># Plot mean observations and references per disturbance variant.</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">available_obs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">available_refs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span>
            <span class="s2">&quot;Plotting mean observations and references per disturbance variant...&quot;</span><span class="p">,</span>
            <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;info&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">n_plots</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s2">&quot;disturbance_label&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>
        <span class="n">figs_tmp</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">disturbance_idx</span><span class="p">,</span> <span class="n">disturbance</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span>
            <span class="n">dataframe</span><span class="p">[</span><span class="s2">&quot;disturbance_label&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
        <span class="p">):</span>
            <span class="c1"># Get observations in long format.</span>
            <span class="n">disturbance_df</span> <span class="o">=</span> <span class="n">dataframe</span><span class="p">[</span><span class="n">dataframe</span><span class="p">[</span><span class="s2">&quot;disturbance_label&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">disturbance</span><span class="p">]</span>
            <span class="n">obs_value_vars</span> <span class="o">=</span> <span class="p">(</span>
                <span class="p">[</span><span class="s2">&quot;observation&quot;</span><span class="p">]</span>
                <span class="k">if</span> <span class="s2">&quot;observation&quot;</span> <span class="ow">in</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">columns</span>
                <span class="k">else</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;observation_</span><span class="si">{</span><span class="n">obs</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">obs</span> <span class="ow">in</span> <span class="n">available_obs</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="n">obs_disturbance_df</span> <span class="o">=</span> <span class="n">disturbance_df</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span>
                <span class="n">id_vars</span><span class="o">=</span><span class="p">[</span><span class="n">x_axis_var</span><span class="p">,</span> <span class="s2">&quot;disturbance_label&quot;</span><span class="p">],</span>
                <span class="n">value_vars</span><span class="o">=</span><span class="n">obs_value_vars</span><span class="p">,</span>
                <span class="n">var_name</span><span class="o">=</span><span class="s2">&quot;observation&quot;</span><span class="p">,</span>
                <span class="n">value_name</span><span class="o">=</span><span class="s2">&quot;value&quot;</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="c1"># Get references in long format.</span>
            <span class="n">refs_value_vars</span> <span class="o">=</span> <span class="p">(</span>
                <span class="p">[</span><span class="s2">&quot;reference&quot;</span><span class="p">]</span>
                <span class="k">if</span> <span class="s2">&quot;reference&quot;</span> <span class="ow">in</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">columns</span>
                <span class="k">else</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;reference_</span><span class="si">{</span><span class="n">ref</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">ref</span> <span class="ow">in</span> <span class="n">available_refs</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="n">refs_disturbance_df</span> <span class="o">=</span> <span class="n">disturbance_df</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span>
                <span class="n">id_vars</span><span class="o">=</span><span class="p">[</span><span class="n">x_axis_var</span><span class="p">,</span> <span class="s2">&quot;disturbance_label&quot;</span><span class="p">],</span>
                <span class="n">value_vars</span><span class="o">=</span><span class="n">refs_value_vars</span><span class="p">,</span>
                <span class="n">var_name</span><span class="o">=</span><span class="s2">&quot;reference&quot;</span><span class="p">,</span>
                <span class="n">value_name</span><span class="o">=</span><span class="s2">&quot;value&quot;</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="c1"># Replace observations and references with short names.</span>
            <span class="n">obs_disturbance_df</span><span class="p">[</span><span class="s2">&quot;observation&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">obs_disturbance_df</span><span class="p">[</span><span class="s2">&quot;observation&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
                <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span>
                    <span class="s2">&quot;observation&quot;</span>
                    <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="s2">&quot;observation&quot;</span>
                    <span class="k">else</span> <span class="n">x</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;observation_&quot;</span><span class="p">,</span> <span class="s2">&quot;obs_&quot;</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="n">refs_disturbance_df</span><span class="p">[</span><span class="s2">&quot;reference&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">refs_disturbance_df</span><span class="p">[</span><span class="s2">&quot;reference&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
                <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span>
                    <span class="s2">&quot;reference&quot;</span> <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="s2">&quot;reference&quot;</span> <span class="k">else</span> <span class="n">x</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;reference_&quot;</span><span class="p">,</span> <span class="s2">&quot;ref_&quot;</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="p">)</span>

            <span class="c1"># Initialize plot/subplots and title.</span>
            <span class="k">if</span> <span class="n">use_subplots</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">disturbance_idx</span> <span class="o">%</span> <span class="mi">6</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span>
                        <span class="n">ncols</span><span class="o">=</span><span class="nb">min</span><span class="p">(</span><span class="n">n_plots</span> <span class="o">-</span> <span class="n">disturbance_idx</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
                        <span class="n">nrows</span><span class="o">=</span><span class="nb">min</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">((</span><span class="n">n_plots</span> <span class="o">-</span> <span class="n">disturbance_idx</span><span class="p">)</span> <span class="o">/</span> <span class="mi">3</span><span class="p">)),</span> <span class="mi">2</span><span class="p">),</span>
                        <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span>
                        <span class="n">tight_layout</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                    <span class="p">)</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Mean observations and references under &#39;</span><span class="si">{</span><span class="n">disturber_name</span><span class="si">}</span><span class="s2">&#39; &quot;</span>
                        <span class="s2">&quot;disturber&quot;</span>
                    <span class="p">)</span>
                <span class="n">ax</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">axs</span><span class="o">.</span><span class="n">flatten</span><span class="p">()[</span><span class="n">disturbance_idx</span> <span class="o">%</span> <span class="mi">6</span><span class="p">]</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">axs</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span>
                    <span class="k">else</span> <span class="n">axs</span>
                <span class="p">)</span>

                <span class="c1"># Create plot title.</span>
                <span class="n">plot_title</span> <span class="o">=</span> <span class="n">get_human_readable_disturber_label</span><span class="p">(</span><span class="n">disturbance</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">tight_layout</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

                <span class="c1"># Create plot title.</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">available_obs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">available_refs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">plot_title</span> <span class="o">=</span> <span class="s2">&quot;Mean </span><span class="si">{}</span><span class="s2"> and </span><span class="si">{}</span><span class="s2"> &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="s2">&quot;observations&quot;</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">available_obs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="s2">&quot;observation&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;references&quot;</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">available_refs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="s2">&quot;reference&quot;</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">available_obs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">plot_title</span> <span class="o">=</span> <span class="s2">&quot;Mean </span><span class="si">{}</span><span class="s2"> &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="s2">&quot;observations&quot;</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">available_obs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="s2">&quot;observation&quot;</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">plot_title</span> <span class="o">=</span> <span class="s2">&quot;Mean </span><span class="si">{}</span><span class="s2"> &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="s2">&quot;references&quot;</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">available_refs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="s2">&quot;reference&quot;</span>
                    <span class="p">)</span>
                <span class="k">if</span> <span class="n">disturbance</span> <span class="o">==</span> <span class="s2">&quot;baseline&quot;</span><span class="p">:</span>
                    <span class="n">plot_title</span> <span class="o">+=</span> <span class="s2">&quot;baseline conditions&quot;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">plot_title</span> <span class="o">+=</span> <span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;under &#39;</span><span class="si">{</span><span class="n">disturber_name</span><span class="si">}</span><span class="s2">&#39; disturber with &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;`</span><span class="si">{</span><span class="n">get_human_readable_disturber_label</span><span class="p">(</span><span class="n">disturbance</span><span class="p">)</span><span class="si">}</span><span class="s2">`&quot;</span>
                    <span class="p">)</span>  <span class="c1"># Fix when disturbance label.</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">manager</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="o">*</span><span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">manager</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">maxsize</span><span class="p">())</span>

            <span class="c1"># Add observations to plot.</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">available_obs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span>
                    <span class="n">data</span><span class="o">=</span><span class="n">obs_disturbance_df</span><span class="p">,</span>
                    <span class="n">x</span><span class="o">=</span><span class="n">x_axis_var</span><span class="p">,</span>
                    <span class="n">y</span><span class="o">=</span><span class="s2">&quot;value&quot;</span><span class="p">,</span>
                    <span class="n">hue</span><span class="o">=</span><span class="s2">&quot;observation&quot;</span><span class="p">,</span>
                    <span class="n">palette</span><span class="o">=</span><span class="s2">&quot;tab10&quot;</span><span class="p">,</span>
                    <span class="n">legend</span><span class="o">=</span><span class="s2">&quot;full&quot;</span><span class="p">,</span>
                    <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
                <span class="p">)</span>

            <span class="c1"># Add references to plot.</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">available_refs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span>
                    <span class="n">data</span><span class="o">=</span><span class="n">refs_disturbance_df</span><span class="p">,</span>
                    <span class="n">x</span><span class="o">=</span><span class="n">x_axis_var</span><span class="p">,</span>
                    <span class="n">y</span><span class="o">=</span><span class="s2">&quot;value&quot;</span><span class="p">,</span>
                    <span class="n">hue</span><span class="o">=</span><span class="s2">&quot;reference&quot;</span><span class="p">,</span>
                    <span class="n">palette</span><span class="o">=</span><span class="s2">&quot;hls&quot;</span><span class="p">,</span>
                    <span class="n">legend</span><span class="o">=</span><span class="s2">&quot;full&quot;</span><span class="p">,</span>
                    <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
                    <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span>
                <span class="p">)</span>

            <span class="c1"># Apply plot settings.</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">x_axis_var</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Value&quot;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span>
                <span class="n">plot_title</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">get_legend</span><span class="p">()</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>

            <span class="c1"># Store figure.</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="n">use_subplots</span>
                <span class="ow">and</span> <span class="n">disturbance_idx</span> <span class="o">%</span> <span class="mi">6</span> <span class="o">==</span> <span class="mi">5</span>
                <span class="ow">or</span> <span class="n">disturbance_idx</span> <span class="o">==</span> <span class="n">n_plots</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="p">):</span>
                <span class="n">figs_tmp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">figs_tmp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>

        <span class="c1"># Store plot.</span>
        <span class="n">figs</span><span class="p">[</span><span class="s2">&quot;observation&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">figs_tmp</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">observations</span> <span class="ow">and</span> <span class="n">references</span><span class="p">):</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span>
                <span class="p">(</span>
                    <span class="s2">&quot;No observations or references available in dataframe. Skipping &quot;</span>
                    <span class="s2">&quot;observation plot.&quot;</span>
                <span class="p">),</span>
                <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;warning&quot;</span><span class="p">,</span>
            <span class="p">)</span>

    <span class="c1"># Plot mean cost per disturbance variant in one plot if available.</span>
    <span class="k">if</span> <span class="s2">&quot;cost&quot;</span> <span class="ow">in</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s2">&quot;Plotting mean cost per disturbance variant...&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;info&quot;</span><span class="p">)</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">tight_layout</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">manager</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="o">*</span><span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">manager</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">maxsize</span><span class="p">())</span>
        <span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span>
            <span class="n">data</span><span class="o">=</span><span class="n">dataframe</span><span class="p">,</span>
            <span class="n">x</span><span class="o">=</span><span class="n">x_axis_var</span><span class="p">,</span>
            <span class="n">y</span><span class="o">=</span><span class="s2">&quot;cost&quot;</span><span class="p">,</span>
            <span class="n">hue</span><span class="o">=</span><span class="s2">&quot;disturbance_label&quot;</span><span class="p">,</span>
            <span class="n">palette</span><span class="o">=</span><span class="s2">&quot;tab10&quot;</span><span class="p">,</span>
            <span class="n">legend</span><span class="o">=</span><span class="s2">&quot;full&quot;</span><span class="p">,</span>
            <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">x_axis_var</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Cost&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Mean cost under &#39;</span><span class="si">{</span><span class="n">disturber_name</span><span class="si">}</span><span class="s2">&#39; disturber&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">get_legend</span><span class="p">()</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
        <span class="n">figs</span><span class="p">[</span><span class="s2">&quot;cost&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span>
            <span class="p">(</span>
                <span class="s2">&quot;Mean cost not plotted since no cost information was found in the &quot;</span>
                <span class="s2">&quot;supplied dataframe. Please ensure the dataframe contains the &#39;cost&#39; &quot;</span>
                <span class="s2">&quot;key.&quot;</span>
            <span class="p">),</span>
            <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;warning&quot;</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="c1"># Plot mean reference error per disturbance variant.</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">available_ref_errors</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span>
            <span class="s2">&quot;Plotting mean reference error per disturbance variant...&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;info&quot;</span>
        <span class="p">)</span>
        <span class="n">n_plots</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s2">&quot;disturbance_label&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>
        <span class="n">figs_tmp</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">disturbance_idx</span><span class="p">,</span> <span class="n">disturbance</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span>
            <span class="n">dataframe</span><span class="p">[</span><span class="s2">&quot;disturbance_label&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
        <span class="p">):</span>
            <span class="c1"># Get reference error in long format.</span>
            <span class="n">disturbance_df</span> <span class="o">=</span> <span class="n">dataframe</span><span class="p">[</span><span class="n">dataframe</span><span class="p">[</span><span class="s2">&quot;disturbance_label&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">disturbance</span><span class="p">]</span>
            <span class="n">ref_errors_value_vars</span> <span class="o">=</span> <span class="p">(</span>
                <span class="p">[</span><span class="s2">&quot;reference_error&quot;</span><span class="p">]</span>
                <span class="k">if</span> <span class="s2">&quot;reference_error&quot;</span> <span class="ow">in</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">columns</span>
                <span class="k">else</span> <span class="p">[</span>
                    <span class="sa">f</span><span class="s2">&quot;reference_error_</span><span class="si">{</span><span class="n">ref_error</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">ref_error</span> <span class="ow">in</span> <span class="n">available_ref_errors</span>
                <span class="p">]</span>
            <span class="p">)</span>
            <span class="n">ref_errors_disturbance_df</span> <span class="o">=</span> <span class="n">disturbance_df</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span>
                <span class="n">id_vars</span><span class="o">=</span><span class="p">[</span><span class="n">x_axis_var</span><span class="p">,</span> <span class="s2">&quot;disturbance_label&quot;</span><span class="p">],</span>
                <span class="n">value_vars</span><span class="o">=</span><span class="n">ref_errors_value_vars</span><span class="p">,</span>
                <span class="n">var_name</span><span class="o">=</span><span class="s2">&quot;reference_error&quot;</span><span class="p">,</span>
                <span class="n">value_name</span><span class="o">=</span><span class="s2">&quot;value&quot;</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="c1"># Replace reference error with short names.</span>
            <span class="n">ref_errors_disturbance_df</span><span class="p">[</span><span class="s2">&quot;reference_error&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ref_errors_disturbance_df</span><span class="p">[</span>
                <span class="s2">&quot;reference_error&quot;</span>
            <span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
                <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span>
                    <span class="s2">&quot;reference_error&quot;</span>
                    <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="s2">&quot;reference_error&quot;</span>
                    <span class="k">else</span> <span class="n">x</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;reference_error_&quot;</span><span class="p">,</span> <span class="s2">&quot;ref_error_&quot;</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="p">)</span>

            <span class="c1"># Initialize plot/subplots and title.</span>
            <span class="k">if</span> <span class="n">use_subplots</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">disturbance_idx</span> <span class="o">%</span> <span class="mi">6</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span>
                        <span class="n">ncols</span><span class="o">=</span><span class="nb">min</span><span class="p">(</span><span class="n">n_plots</span> <span class="o">-</span> <span class="n">disturbance_idx</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
                        <span class="n">nrows</span><span class="o">=</span><span class="nb">min</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">((</span><span class="n">n_plots</span> <span class="o">-</span> <span class="n">disturbance_idx</span><span class="p">)</span> <span class="o">/</span> <span class="mi">3</span><span class="p">)),</span> <span class="mi">2</span><span class="p">),</span>
                        <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span>
                        <span class="n">tight_layout</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="n">ax</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">axs</span><span class="o">.</span><span class="n">flatten</span><span class="p">()[</span><span class="n">disturbance_idx</span> <span class="o">%</span> <span class="mi">6</span><span class="p">]</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">axs</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span>
                    <span class="k">else</span> <span class="n">axs</span>
                <span class="p">)</span>

                <span class="c1"># Create plot title.</span>
                <span class="n">plot_title</span> <span class="o">=</span> <span class="n">get_human_readable_disturber_label</span><span class="p">(</span><span class="n">disturbance</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">tight_layout</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

                <span class="c1"># Create plot title.</span>
                <span class="n">plot_title</span> <span class="o">=</span> <span class="s2">&quot;Mean </span><span class="si">{}</span><span class="s2"> &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="p">(</span>
                        <span class="s2">&quot;reference errors&quot;</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">available_ref_errors</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span>
                        <span class="k">else</span> <span class="s2">&quot;reference error&quot;</span>
                    <span class="p">),</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="n">disturbance</span> <span class="o">==</span> <span class="s2">&quot;baseline&quot;</span><span class="p">:</span>
                    <span class="n">plot_title</span> <span class="o">+=</span> <span class="s2">&quot;baseline conditions&quot;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">plot_title</span> <span class="o">+=</span> <span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;under &#39;</span><span class="si">{</span><span class="n">disturber_name</span><span class="si">}</span><span class="s2">&#39; disturber with &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;`</span><span class="si">{</span><span class="n">get_human_readable_disturber_label</span><span class="p">(</span><span class="n">disturbance</span><span class="p">)</span><span class="si">}</span><span class="s2">`&quot;</span>
                    <span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">manager</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="o">*</span><span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">manager</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">maxsize</span><span class="p">())</span>

            <span class="c1"># Add reference error to plot.</span>
            <span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span>
                <span class="n">data</span><span class="o">=</span><span class="n">ref_errors_disturbance_df</span><span class="p">,</span>
                <span class="n">x</span><span class="o">=</span><span class="n">x_axis_var</span><span class="p">,</span>
                <span class="n">y</span><span class="o">=</span><span class="s2">&quot;value&quot;</span><span class="p">,</span>
                <span class="n">hue</span><span class="o">=</span><span class="s2">&quot;reference_error&quot;</span><span class="p">,</span>
                <span class="n">palette</span><span class="o">=</span><span class="s2">&quot;tab10&quot;</span><span class="p">,</span>
                <span class="n">legend</span><span class="o">=</span><span class="s2">&quot;full&quot;</span><span class="p">,</span>
                <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="c1"># Configure plot.</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">x_axis_var</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Value&quot;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span>
                <span class="n">plot_title</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">get_legend</span><span class="p">()</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>

            <span class="c1"># Add figure title if using subplots.</span>
            <span class="k">if</span> <span class="n">use_subplots</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Mean reference error under &#39;</span><span class="si">{</span><span class="n">disturber_name</span><span class="si">}</span><span class="s2">&#39; disturber&quot;</span><span class="p">)</span>

            <span class="c1"># Store figure.</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="n">use_subplots</span>
                <span class="ow">and</span> <span class="n">disturbance_idx</span> <span class="o">%</span> <span class="mi">6</span> <span class="o">==</span> <span class="mi">5</span>
                <span class="ow">or</span> <span class="n">disturbance_idx</span> <span class="o">==</span> <span class="n">n_plots</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="p">):</span>
                <span class="n">figs_tmp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">figs_tmp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>

        <span class="c1"># Store plot.</span>
        <span class="n">figs</span><span class="p">[</span><span class="s2">&quot;reference_error&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">figs_tmp</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">reference_errors</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span>
                <span class="p">(</span>
                    <span class="s2">&quot;Mean reference error not plotted since no reference error &quot;</span>
                    <span class="s2">&quot;information was found in the supplied dataframe. Please ensure &quot;</span>
                    <span class="s2">&quot;the dataframe contains the &#39;reference_error&#39; key.&quot;</span>
                <span class="p">),</span>
                <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;warning&quot;</span><span class="p">,</span>
            <span class="p">)</span>

    <span class="c1"># Initialize Weights &amp; Biases if requested and not already initialized.</span>
    <span class="k">if</span> <span class="n">use_wandb</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">wandb</span>

        <span class="k">if</span> <span class="n">wandb</span><span class="o">.</span><span class="n">run</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">wandb</span><span class="o">.</span><span class="n">init</span><span class="p">(</span>
                <span class="n">project</span><span class="o">=</span><span class="n">wandb_project</span><span class="p">,</span>
                <span class="n">group</span><span class="o">=</span><span class="n">wandb_group</span><span class="p">,</span>
                <span class="n">job_type</span><span class="o">=</span><span class="n">wandb_job_type</span><span class="p">,</span>
                <span class="n">name</span><span class="o">=</span><span class="n">wandb_run_name</span><span class="p">,</span>
            <span class="p">)</span>

    <span class="c1"># Store plots.</span>
    <span class="k">if</span> <span class="n">save_plots</span> <span class="ow">or</span> <span class="n">use_wandb</span><span class="p">:</span>
        <span class="n">figs_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">logger</span><span class="o">.</span><span class="n">output_dir</span><span class="p">)</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="s2">&quot;figures&quot;</span><span class="p">)</span>
        <span class="n">figs_extension</span> <span class="o">=</span> <span class="n">figs_fmt</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="k">if</span> <span class="n">figs_fmt</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="n">figs_fmt</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">figs_path</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s2">&quot;Saving plots...&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;info&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">save_plots</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Saving figures to path: </span><span class="si">{</span><span class="n">figs_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;info&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">use_wandb</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s2">&quot;Saving figures to Weights &amp; Biases...&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;info&quot;</span><span class="p">)</span>

        <span class="c1"># Store observation plots.</span>
        <span class="k">if</span> <span class="n">figs</span><span class="p">[</span><span class="s2">&quot;observation&quot;</span><span class="p">]:</span>
            <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">fig</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">figs</span><span class="p">[</span><span class="s2">&quot;observation&quot;</span><span class="p">]):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">use_subplots</span><span class="p">:</span>
                    <span class="n">fig_id</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="s2">&quot;baseline&quot;</span>
                        <span class="k">if</span> <span class="n">convert_to_snake_case</span><span class="p">(</span><span class="n">disturber_name</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;baseline&quot;</span>
                        <span class="k">else</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">-</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                            <span class="n">convert_to_snake_case</span><span class="p">(</span><span class="n">disturber_name</span><span class="p">),</span>
                            <span class="n">dataframe</span><span class="p">[</span><span class="s2">&quot;disturbance_label&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()[</span><span class="n">idx</span><span class="p">],</span>
                        <span class="p">)</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">fig_id</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">-subplots-fig_</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">convert_to_snake_case</span><span class="p">(</span><span class="n">disturber_name</span><span class="p">),</span> <span class="n">idx</span> <span class="o">+</span> <span class="mi">1</span>
                    <span class="p">)</span>
                <span class="n">fig_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;observations-</span><span class="si">{</span><span class="n">fig_id</span><span class="si">}</span><span class="s2">&quot;</span>

                <span class="c1"># Save figures to disk.</span>
                <span class="k">if</span> <span class="n">save_plots</span><span class="p">:</span>
                    <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span>
                        <span class="n">figs_path</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">fig_name</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">figs_extension</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">),</span>
                        <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">,</span>
                    <span class="p">)</span>

                <span class="c1"># Save figures to Weights &amp; Biases.</span>
                <span class="k">if</span> <span class="n">use_wandb</span><span class="p">:</span>
                    <span class="c1"># IMPROVE: Can be replaced with wandb.log({fig_name: fig}) once</span>
                    <span class="c1"># https://github.com/wandb/wandb/issues/3987 has been solved.</span>
                    <span class="n">wandb</span><span class="o">.</span><span class="n">log</span><span class="p">(</span>
                        <span class="p">{</span><span class="n">fig_name</span><span class="p">:</span> <span class="n">wandb</span><span class="o">.</span><span class="n">Image</span><span class="p">(</span><span class="n">fig</span><span class="p">)},</span>
                    <span class="p">)</span>

        <span class="c1"># Store cost plots.</span>
        <span class="k">if</span> <span class="n">figs</span><span class="p">[</span><span class="s2">&quot;cost&quot;</span><span class="p">]:</span>
            <span class="n">fig_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;cost-</span><span class="si">{</span><span class="n">convert_to_snake_case</span><span class="p">(</span><span class="n">disturber_name</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>

            <span class="c1"># Save figures to disk.</span>
            <span class="k">if</span> <span class="n">save_plots</span><span class="p">:</span>
                <span class="n">figs</span><span class="p">[</span><span class="s2">&quot;cost&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span>
                    <span class="n">figs_path</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">fig_name</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">figs_extension</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="p">),</span>
                    <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">,</span>
                <span class="p">)</span>

            <span class="c1"># Save figures to Weights &amp; Biases.</span>
            <span class="k">if</span> <span class="n">use_wandb</span><span class="p">:</span>
                <span class="c1"># IMPROVE: Can be replaced with wandb.log({fig_name: fig}) once</span>
                <span class="c1"># https://github.com/wandb/wandb/issues/3987 has been solved.</span>
                <span class="n">wandb</span><span class="o">.</span><span class="n">log</span><span class="p">(</span>
                    <span class="p">{</span><span class="n">fig_name</span><span class="p">:</span> <span class="n">wandb</span><span class="o">.</span><span class="n">Image</span><span class="p">(</span><span class="n">figs</span><span class="p">[</span><span class="s2">&quot;cost&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">])},</span>
                <span class="p">)</span>

        <span class="c1"># Store reference error plots.</span>
        <span class="k">if</span> <span class="n">figs</span><span class="p">[</span><span class="s2">&quot;reference_error&quot;</span><span class="p">]:</span>
            <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">fig</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">figs</span><span class="p">[</span><span class="s2">&quot;reference_error&quot;</span><span class="p">]):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">use_subplots</span><span class="p">:</span>
                    <span class="n">fig_id</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">-</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">convert_to_snake_case</span><span class="p">(</span><span class="n">disturber_name</span><span class="p">),</span>
                        <span class="n">dataframe</span><span class="p">[</span><span class="s2">&quot;disturbance_label&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()[</span><span class="n">idx</span><span class="p">],</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">fig_id</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">-subplots-fig_</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">convert_to_snake_case</span><span class="p">(</span><span class="n">disturber_name</span><span class="p">),</span> <span class="n">idx</span> <span class="o">+</span> <span class="mi">1</span>
                    <span class="p">)</span>
                <span class="n">fig_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;reference_error-</span><span class="si">{</span><span class="n">fig_id</span><span class="si">}</span><span class="s2">&quot;</span>

                <span class="c1"># Save figures to disk.</span>
                <span class="k">if</span> <span class="n">save_plots</span><span class="p">:</span>
                    <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span>
                        <span class="n">figs_path</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">fig_name</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">figs_extension</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">),</span>
                        <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">,</span>
                    <span class="p">)</span>

                <span class="c1"># Save figures to Weights &amp; Biases.</span>
                <span class="k">if</span> <span class="n">use_wandb</span><span class="p">:</span>
                    <span class="c1"># IMPROVE: Can be replaced with wandb.log({fig_name: fig}) once</span>
                    <span class="c1"># https://github.com/wandb/wandb/issues/3987 has been solved.</span>
                    <span class="n">wandb</span><span class="o">.</span><span class="n">log</span><span class="p">(</span>
                        <span class="p">{</span><span class="n">fig_name</span><span class="p">:</span> <span class="n">wandb</span><span class="o">.</span><span class="n">Image</span><span class="p">(</span><span class="n">fig</span><span class="p">)},</span>
                    <span class="p">)</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s2">&quot;Plots saved.&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;info&quot;</span><span class="p">)</span>

    <span class="c1"># Wait for user to close plots before continuing.</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">argparse</span>

    <span class="c1"># Print available disturbers if &#39;--list_disturbers&#39;/&#39;--list&#39; argument is supplied.</span>
<div class="viewcode-block" id="args"><a class="viewcode-back" href="../../../autoapi/stable_learning_control/utils/eval_robustness/index.html#stable_learning_control.utils.eval_robustness.args">[docs]</a>    <span class="n">args</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span></div>
    <span class="k">if</span> <span class="s2">&quot;--list_disturbers&quot;</span> <span class="ow">in</span> <span class="n">args</span> <span class="ow">or</span> <span class="s2">&quot;--list&quot;</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
        <span class="n">print_available_disturbers</span><span class="p">()</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>

    <span class="c1"># Check if &#39;--help&#39;, &#39;-h&#39; or &#39;help&#39; is supplied after the disturber name.</span>
    <span class="n">disturber_help</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="n">disturber_name</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">disturber_help</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;--help&quot;</span><span class="p">,</span> <span class="s2">&quot;-h&quot;</span><span class="p">,</span> <span class="s2">&quot;help&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">disturber_help</span><span class="p">:</span>
            <span class="c1"># Remove &#39;--help&#39;, &#39;-h&#39; or &#39;help&#39; from args to prevent argparse error.</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>

    <span class="c1"># Parse other arguments.</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">()</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;fpath&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;The path where the policy is stored&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;disturber&quot;</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;The disturber you want to use for the robustness evaluation (e.g. &quot;</span>
            <span class="s2">&quot;&#39;ObservationRandomNoiseDisturber&#39;). Can include an unloaded module &quot;</span>
            <span class="s2">&quot;in &#39;module:disturber_name&#39; style.&quot;</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--list_disturbers&quot;</span><span class="p">,</span>
        <span class="s2">&quot;--list&quot;</span><span class="p">,</span>
        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;List available disturbers in the SLC package&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--disturber_config&quot;</span><span class="p">,</span>
        <span class="s2">&quot;--cfg&quot;</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;The configuration you want to pass to the disturber. It sets up the range &quot;</span>
            <span class="s2">&quot;of disturbances you wish to evaluate. Expects a dictionary that depends &quot;</span>
            <span class="s2">&quot;on the specified disturber (e.g. </span><span class="se">\&quot;</span><span class="s2">{&#39;mean&#39;: [0.25, 0.25], &#39;std&#39;: [0.05, &quot;</span>
            <span class="s2">&quot;0.05]}</span><span class="se">\&quot;</span><span class="s2"> for &#39;ObservationRandomNoiseDisturber&#39; disturber)&quot;</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--data_dir&quot;</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;The path where you want to store to store the robustness evaluation &quot;</span>
            <span class="s2">&quot;results, meaning the dataframe and the plots (default: &#39;DEFAULT_DATA_DIR&#39; &quot;</span>
            <span class="s2">&quot;parameter from the &#39;user_config&#39; file)&quot;</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--itr&quot;</span><span class="p">,</span>
        <span class="s2">&quot;-i&quot;</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;The policy iteration (epoch) you want to use (default: last)&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--len&quot;</span><span class="p">,</span>
        <span class="s2">&quot;-l&quot;</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;The episode length (default: environment &#39;max_episode_steps&#39;)&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--episodes&quot;</span><span class="p">,</span>
        <span class="s2">&quot;-n&quot;</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;The number of episodes you want to run per disturbance variant &quot;</span>
            <span class="s2">&quot;(default: 100)&quot;</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--render&quot;</span><span class="p">,</span>
        <span class="s2">&quot;-r&quot;</span><span class="p">,</span>
        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Whether you want to render the environment step (default: False)&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--deterministic&quot;</span><span class="p">,</span>
        <span class="s2">&quot;-d&quot;</span><span class="p">,</span>
        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;Whether you want to use a deterministic policy. Only available for &quot;</span>
            <span class="s2">&quot;Gaussian policies (default: False)&quot;</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--disable_baseline&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;Whether you want to disable the baseline (i.e. zero disturbance) from &quot;</span>
            <span class="s2">&quot;being added to the disturbance array automatically (default: False)&quot;</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--observations&quot;</span><span class="p">,</span>
        <span class="s2">&quot;--obs&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">nargs</span><span class="o">=</span><span class="s2">&quot;*&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;The observations you want to show in the observations/references plot &quot;</span>
            <span class="s2">&quot;(default: only the first 6 observations). Keep empty to hide observations&quot;</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--references&quot;</span><span class="p">,</span>
        <span class="s2">&quot;--refs&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">nargs</span><span class="o">=</span><span class="s2">&quot;*&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;The references you want to show in the observations/references plot &quot;</span>
            <span class="s2">&quot;(default: only the first reference). Keep empty to hide references&quot;</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--reference_errors&quot;</span><span class="p">,</span>
        <span class="s2">&quot;--ref_errs&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">nargs</span><span class="o">=</span><span class="s2">&quot;*&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;The reference errors you want to show in the reference errors plot &quot;</span>
            <span class="s2">&quot;(default: only the first reference error). Keep empty to hide reference &quot;</span>
            <span class="s2">&quot;errors&quot;</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--absolute_reference_errors&quot;</span><span class="p">,</span>
        <span class="s2">&quot;--abs_ref_errs&quot;</span><span class="p">,</span>
        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;Whether you want to use absolute reference errors instead of relative &quot;</span>
            <span class="s2">&quot;reference errors (default: False)&quot;</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--merge_reference_errors&quot;</span><span class="p">,</span>
        <span class="s2">&quot;--merge_ref_errs&quot;</span><span class="p">,</span>
        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;Whether you want to merge the reference errors into one reference error &quot;</span>
            <span class="s2">&quot;(default: False)&quot;</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--use_subplots&quot;</span><span class="p">,</span>
        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;Whether you want to use subplots instead of separate figures &quot;</span>
            <span class="s2">&quot;(default: False)&quot;</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--use_time&quot;</span><span class="p">,</span>
        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;Whether you want to use time as the x-axis instead of steps &quot;</span>
            <span class="s2">&quot;(default: False)&quot;</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--save_result&quot;</span><span class="p">,</span>
        <span class="s2">&quot;--save&quot;</span><span class="p">,</span>
        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;Whether you want to save the robustness evaluation dataframe to disk &quot;</span>
            <span class="s2">&quot;(default: False)&quot;</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--save_plots&quot;</span><span class="p">,</span>
        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Whether you want to save the plots (default: False)&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--figs_fmt&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="s2">&quot;pdf&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;The filetype you want to use for the plots (default: pdf)&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--font_scale&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;The font scale you want to use for the plot text (default: 1.5)&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--use_wandb&quot;</span><span class="p">,</span>
        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;use Weights &amp; Biases logging (default: False)&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--wandb_job_type&quot;</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="s2">&quot;eval&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;the Weights &amp; Biases job type (default: eval)&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--wandb_project&quot;</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="s2">&quot;stable-learning-control&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;the name of the wandb project (default: stable-learning-control)&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--wandb_group&quot;</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;the name of the Weights &amp; Biases group you want to assign the run to &quot;</span>
            <span class="s2">&quot;(defaults: None)&quot;</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--wandb_run_name&quot;</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;the name of the Weights &amp; Biases run (defaults: None, will be &quot;</span>
            <span class="s2">&quot;automatically generated based on the policy directory and disturber&quot;</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>

    <span class="c1"># Load policy and environment.</span>
    <span class="n">env</span><span class="p">,</span> <span class="n">policy</span> <span class="o">=</span> <span class="n">load_policy_and_env</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">fpath</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">itr</span> <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">itr</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="k">else</span> <span class="s2">&quot;last&quot;</span><span class="p">)</span>

    <span class="c1"># Load the disturber or throw an error if it does not exist.</span>
    <span class="n">disturber</span> <span class="o">=</span> <span class="n">load_disturber</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">disturber</span><span class="p">)</span>

    <span class="c1"># Return disturber help if requested.</span>
    <span class="k">if</span> <span class="n">disturber_help</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">Showing docstring for &#39;</span><span class="si">{</span><span class="n">args</span><span class="o">.</span><span class="n">disturber</span><span class="si">}</span><span class="s2">:</span><span class="se">\n</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="s2">&quot;</span><span class="se">\t</span><span class="si">{}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">cleandoc</span><span class="p">(</span><span class="n">disturber</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n\t</span><span class="s2">&quot;</span><span class="p">))</span>
        <span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="s2">&quot;</span><span class="se">\t</span><span class="si">{}</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">inspect</span><span class="o">.</span><span class="n">cleandoc</span><span class="p">(</span><span class="n">disturber</span><span class="o">.</span><span class="fm">__init__</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n\t</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>

    <span class="c1"># Retrieve disturber configuration.</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">disturber_config</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">args</span><span class="o">.</span><span class="n">disturber_config</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">literal_eval</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">disturber_config</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="n">friendly_err</span><span class="p">(</span>
                <span class="s2">&quot;The supplied &#39;--disturber_config&#39; is not a valid dictionary. Please &quot;</span>
                <span class="s2">&quot;make sure you supply a valid dictionary.&quot;</span>
            <span class="p">)</span>
        <span class="p">)</span>

    <span class="c1"># Set data directory to the fpath directory if not specified.</span>
    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">data_dir</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">args</span><span class="o">.</span><span class="n">data_dir</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">fpath</span>

    <span class="c1"># Create wandb run name if not specified.</span>
    <span class="n">wandb_run_name</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">(</span>
            <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">_</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">PurePath</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">fpath</span><span class="p">)</span><span class="o">.</span><span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                <span class="p">(</span>
                    <span class="n">convert_to_snake_case</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">disturber</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">disturber</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                    <span class="k">else</span> <span class="s2">&quot;baseline&quot;</span>
                <span class="p">),</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">wandb_run_name</span> <span class="ow">is</span> <span class="kc">None</span>
            <span class="k">else</span> <span class="n">args</span><span class="o">.</span><span class="n">wandb_run_name</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">use_wandb</span>
        <span class="k">else</span> <span class="kc">None</span>
    <span class="p">)</span>

    <span class="c1"># Perform robustness evaluation and plot results.</span>
    <span class="n">run_results_df</span> <span class="o">=</span> <span class="n">run_disturbed_policy</span><span class="p">(</span>
        <span class="n">env</span><span class="p">,</span>
        <span class="n">policy</span><span class="p">,</span>
        <span class="n">disturber</span><span class="p">,</span>
        <span class="n">disturber_config</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">disturber_config</span><span class="p">,</span>
        <span class="n">include_baseline</span><span class="o">=</span><span class="p">(</span><span class="ow">not</span> <span class="n">args</span><span class="o">.</span><span class="n">disable_baseline</span><span class="p">),</span>
        <span class="n">max_ep_len</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">len</span><span class="p">,</span>
        <span class="n">num_episodes</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">episodes</span><span class="p">,</span>
        <span class="n">render</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">render</span><span class="p">,</span>
        <span class="n">deterministic</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">deterministic</span><span class="p">,</span>
        <span class="n">save_result</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">save_result</span><span class="p">,</span>
        <span class="n">output_dir</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">data_dir</span><span class="p">,</span>
        <span class="n">use_wandb</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">use_wandb</span><span class="p">,</span>
        <span class="n">wandb_job_type</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">wandb_job_type</span><span class="p">,</span>
        <span class="n">wandb_project</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">wandb_project</span><span class="p">,</span>
        <span class="n">wandb_group</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">wandb_group</span><span class="p">,</span>
        <span class="n">wandb_run_name</span><span class="o">=</span><span class="n">wandb_run_name</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">plot_robustness_results</span><span class="p">(</span>
        <span class="n">run_results_df</span><span class="p">,</span>
        <span class="n">observations</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">observations</span><span class="p">,</span>
        <span class="n">references</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">references</span><span class="p">,</span>
        <span class="n">reference_errors</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">reference_errors</span><span class="p">,</span>
        <span class="n">absolute_reference_errors</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">absolute_reference_errors</span><span class="p">,</span>
        <span class="n">merge_reference_errors</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">merge_reference_errors</span><span class="p">,</span>
        <span class="n">use_subplots</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">use_subplots</span><span class="p">,</span>
        <span class="n">use_time</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">use_time</span><span class="p">,</span>
        <span class="n">save_plots</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">save_plots</span><span class="p">,</span>
        <span class="n">font_scale</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">font_scale</span><span class="p">,</span>
        <span class="n">figs_fmt</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">figs_fmt</span><span class="p">,</span>
        <span class="n">output_dir</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">data_dir</span><span class="p">,</span>
        <span class="n">use_wandb</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">use_wandb</span><span class="p">,</span>
        <span class="n">wandb_job_type</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">wandb_job_type</span><span class="p">,</span>
        <span class="n">wandb_project</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">wandb_project</span><span class="p">,</span>
        <span class="n">wandb_group</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">wandb_group</span><span class="p">,</span>
        <span class="n">wandb_run_name</span><span class="o">=</span><span class="n">wandb_run_name</span><span class="p">,</span>
    <span class="p">)</span>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Rick Staa.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>