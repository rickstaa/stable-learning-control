<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>stable_learning_control.run &mdash; stable-learning-control 6.0.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css?v=eafc0fe6" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/modify.css?v=519ed47b" />

  
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js?v=9497d378"></script>
        <script src="../../_static/doctools.js?v=888ff710"></script>
        <script src="../../_static/sphinx_highlight.js?v=4825356b"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html">
            
              <img src="../../_static/logo.svg" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                6.0.1
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Usage</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../usage/installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usage/docker.html">Use with Docker</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usage/algorithms.html">Available Agents</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usage/running.html">Running Experiments</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usage/hyperparameter_tuning.html">Hyperparameter Tuning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usage/saving_and_loading.html">Experiment Outputs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usage/plotting.html">Plotting Results</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usage/eval_robustness.html">Evaluating Robustness</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usage/benchmarks.html">Benchmarks</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Utilities</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../utils/loggers.html">Loggers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../utils/mpi.html">MPI Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../utils/run_utils.html">Run Utils</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../utils/plotter.html">Plotter</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../utils/testers.html">Policy testers</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Development</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../dev/contributing.html">Contribute to stable-learning-control</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev/doc_dev.html">Build the documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev/license.html">License</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../autoapi/index.html">API Reference</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Etc.</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../etc/acknowledgements.html">Acknowledgements</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">stable-learning-control</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Module code</a></li>
      <li class="breadcrumb-item active">stable_learning_control.run</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for stable_learning_control.run</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;Responsible for creating the CLI for the stable_learning_control package. It can</span>
<span class="sd">be used to start the training of an algorithm, or run any of the other utilities.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">inspect</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">os.path</span> <span class="k">as</span> <span class="nn">osp</span>
<span class="kn">import</span> <span class="nn">subprocess</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">deepcopy</span>
<span class="kn">from</span> <span class="nn">textwrap</span> <span class="kn">import</span> <span class="n">dedent</span>

<span class="kn">from</span> <span class="nn">ruamel.yaml</span> <span class="kn">import</span> <span class="n">YAML</span><span class="p">,</span> <span class="n">YAMLError</span>

<span class="kn">from</span> <span class="nn">stable_learning_control.common.helpers</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">flatten</span><span class="p">,</span>
    <span class="n">friendly_err</span><span class="p">,</span>
    <span class="n">get_unique_list</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">stable_learning_control.user_config</span> <span class="kn">import</span> <span class="n">DEFAULT_BACKEND</span>
<span class="kn">from</span> <span class="nn">stable_learning_control.utils.gym_utils</span> <span class="kn">import</span> <span class="n">validate_gym_env</span>
<span class="kn">from</span> <span class="nn">stable_learning_control.utils.import_utils</span> <span class="kn">import</span> <span class="n">tf_installed</span>
<span class="kn">from</span> <span class="nn">stable_learning_control.utils.log_utils.helpers</span> <span class="kn">import</span> <span class="n">log_to_std_out</span>
<span class="kn">from</span> <span class="nn">stable_learning_control.utils.run_utils</span> <span class="kn">import</span> <span class="n">ExperimentGrid</span>
<span class="kn">from</span> <span class="nn">stable_learning_control.utils.safer_eval_util</span> <span class="kn">import</span> <span class="n">safer_eval</span>
<span class="kn">from</span> <span class="nn">stable_learning_control.version</span> <span class="kn">import</span> <span class="n">__version__</span>

<span class="c1"># Command line args that will go to ExperimentGrid.run, and must possess unique values</span>
<span class="c1"># (therefore must be treated separately).</span>
<div class="viewcode-block" id="RUN_KEYS"><a class="viewcode-back" href="../../autoapi/stable_learning_control/run/index.html#stable_learning_control.run.RUN_KEYS">[docs]</a><span class="n">RUN_KEYS</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;num_cpu&quot;</span><span class="p">,</span> <span class="s2">&quot;data_dir&quot;</span><span class="p">,</span> <span class="s2">&quot;datestamp&quot;</span><span class="p">]</span></div>

<span class="c1"># Command line sweetener, allowing short-form flags for common, longer flags.</span>
<div class="viewcode-block" id="SUBSTITUTIONS"><a class="viewcode-back" href="../../autoapi/stable_learning_control/run/index.html#stable_learning_control.run.SUBSTITUTIONS">[docs]</a><span class="n">SUBSTITUTIONS</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;env&quot;</span><span class="p">:</span> <span class="s2">&quot;env_name&quot;</span><span class="p">,</span>
    <span class="s2">&quot;env_k&quot;</span><span class="p">:</span> <span class="s2">&quot;env_kwargs&quot;</span><span class="p">,</span>
    <span class="s2">&quot;hid&quot;</span><span class="p">:</span> <span class="s2">&quot;ac_kwargs:hidden_sizes&quot;</span><span class="p">,</span>
    <span class="s2">&quot;hid_a&quot;</span><span class="p">:</span> <span class="s2">&quot;ac_kwargs:hidden_sizes:actor&quot;</span><span class="p">,</span>
    <span class="s2">&quot;hid_c&quot;</span><span class="p">:</span> <span class="s2">&quot;ac_kwargs:hidden_sizes:critic&quot;</span><span class="p">,</span>
    <span class="s2">&quot;act&quot;</span><span class="p">:</span> <span class="s2">&quot;ac_kwargs:activation&quot;</span><span class="p">,</span>
    <span class="s2">&quot;act_out&quot;</span><span class="p">:</span> <span class="s2">&quot;ac_kwargs:output_activation&quot;</span><span class="p">,</span>
    <span class="s2">&quot;act_a&quot;</span><span class="p">:</span> <span class="s2">&quot;ac_kwargs:activation:actor&quot;</span><span class="p">,</span>
    <span class="s2">&quot;act_out_a&quot;</span><span class="p">:</span> <span class="s2">&quot;ac_kwargs:output_activation:actor&quot;</span><span class="p">,</span>
    <span class="s2">&quot;act_c&quot;</span><span class="p">:</span> <span class="s2">&quot;ac_kwargs:activation:critic&quot;</span><span class="p">,</span>
    <span class="s2">&quot;act_out_c&quot;</span><span class="p">:</span> <span class="s2">&quot;ac_kwargs:output_activation:critic&quot;</span><span class="p">,</span>
    <span class="s2">&quot;cpu&quot;</span><span class="p">:</span> <span class="s2">&quot;num_cpu&quot;</span><span class="p">,</span>
    <span class="s2">&quot;dt&quot;</span><span class="p">:</span> <span class="s2">&quot;datestamp&quot;</span><span class="p">,</span>
    <span class="s2">&quot;q&quot;</span><span class="p">:</span> <span class="s2">&quot;quiet&quot;</span><span class="p">,</span>
    <span class="s2">&quot;use_tb&quot;</span><span class="p">:</span> <span class="s2">&quot;logger_kwargs:use_tensorboard&quot;</span><span class="p">,</span>
    <span class="s2">&quot;use_wandb&quot;</span><span class="p">:</span> <span class="s2">&quot;logger_kwargs:use_wandb&quot;</span><span class="p">,</span>
    <span class="s2">&quot;wandb_job_type&quot;</span><span class="p">:</span> <span class="s2">&quot;logger_kwargs:wandb_job_type&quot;</span><span class="p">,</span>
    <span class="s2">&quot;wandb_proj&quot;</span><span class="p">:</span> <span class="s2">&quot;logger_kwargs:wandb_project&quot;</span><span class="p">,</span>
    <span class="s2">&quot;wandb_group&quot;</span><span class="p">:</span> <span class="s2">&quot;logger_kwargs:wandb_group&quot;</span><span class="p">,</span>
    <span class="s2">&quot;wandb_run_name&quot;</span><span class="p">:</span> <span class="s2">&quot;logger_kwargs:wandb_run_name&quot;</span><span class="p">,</span>
    <span class="s2">&quot;save_cps&quot;</span><span class="p">:</span> <span class="s2">&quot;logger_kwargs:save_checkpoints&quot;</span><span class="p">,</span>
    <span class="s2">&quot;tb_log_freq&quot;</span><span class="p">:</span> <span class="s2">&quot;logger_kwargs:tb_log_freq&quot;</span><span class="p">,</span>
    <span class="s2">&quot;quiet&quot;</span><span class="p">:</span> <span class="s2">&quot;logger_kwargs:quiet&quot;</span><span class="p">,</span>
    <span class="s2">&quot;verbose_fmt&quot;</span><span class="p">:</span> <span class="s2">&quot;logger_kwargs:verbose_fmt&quot;</span><span class="p">,</span>
    <span class="s2">&quot;verbose_vars&quot;</span><span class="p">:</span> <span class="s2">&quot;logger_kwargs:verbose_vars&quot;</span><span class="p">,</span>
<span class="p">}</span></div>

<span class="c1"># Only some algorithms can be parallelized (have num_cpu &gt; 1).</span>
<div class="viewcode-block" id="MPI_COMPATIBLE_ALGOS"><a class="viewcode-back" href="../../autoapi/stable_learning_control/run/index.html#stable_learning_control.run.MPI_COMPATIBLE_ALGOS">[docs]</a><span class="n">MPI_COMPATIBLE_ALGOS</span> <span class="o">=</span> <span class="p">[]</span></div>

<span class="c1"># Algo names (used in a few places).</span>
<div class="viewcode-block" id="BASE_ALGO_NAMES"><a class="viewcode-back" href="../../autoapi/stable_learning_control/run/index.html#stable_learning_control.run.BASE_ALGO_NAMES">[docs]</a><span class="n">BASE_ALGO_NAMES</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;sac&quot;</span><span class="p">,</span> <span class="s2">&quot;lac&quot;</span><span class="p">,</span> <span class="s2">&quot;latc&quot;</span><span class="p">]</span></div>


<div class="viewcode-block" id="_parse_hyperparameter_variants"><a class="viewcode-back" href="../../autoapi/stable_learning_control/run/index.html#stable_learning_control.run._parse_hyperparameter_variants">[docs]</a><span class="k">def</span> <span class="nf">_parse_hyperparameter_variants</span><span class="p">(</span><span class="n">exp_val</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Function parses exp config values to make sure that comma/space separated</span>
<span class="sd">    strings (i.e. ``5, 3, 2`` or ``5 3 2``)) are recognized as hyperparameter variants.</span>

<span class="sd">    Args:</span>
<span class="sd">        exp_val (object): The variable to parse.</span>

<span class="sd">    Returns:</span>
<span class="sd">        union[:obj:`str`, :obj:`list`, :obj:`None`]: A hyper parameter string or list.</span>
<span class="sd">            Returns ``None`` if ``exp_val`` is ``None``.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">exp_val</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">exp_val</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">exp_val</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">get_unique_list</span><span class="p">(</span><span class="n">exp_val</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;,&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">))</span></div>


<div class="viewcode-block" id="_parse_exp_cfg"><a class="viewcode-back" href="../../autoapi/stable_learning_control/run/index.html#stable_learning_control.run._parse_exp_cfg">[docs]</a><span class="k">def</span> <span class="nf">_parse_exp_cfg</span><span class="p">(</span><span class="n">cmd_line_args</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;This function parses the cmd line args to see if it contains the ``exp_cfg``</span>
<span class="sd">    flag. If this flag is present it uses the ``exp_cfg`` file path (next cmd_line arg)</span>
<span class="sd">    to add any hyperparameters found in this experimental configuration file to the cmd</span>
<span class="sd">    line arguments.</span>

<span class="sd">    Args:</span>
<span class="sd">        cmd_line_args (list): The cmd line input arguments.</span>

<span class="sd">    Returns:</span>
<span class="sd">        list: Modified cmd line argument list that also contains any hyperparameters</span>
<span class="sd">            that were specified in a experimental cfg file.</span>

<span class="sd">    .. note::</span>
<span class="sd">        This function assumes comma/space separated strings (i.e. ``5, 3, 2`` or</span>
<span class="sd">        ``5 3 2``)) to be hyperparmeter variants.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="s2">&quot;--exp_cfg&quot;</span> <span class="ow">in</span> <span class="n">cmd_line_args</span><span class="p">:</span>
        <span class="n">exp_cfg_idx</span> <span class="o">=</span> <span class="n">cmd_line_args</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;--exp_cfg&quot;</span><span class="p">)</span>
        <span class="n">cmd_line_args</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">exp_cfg_idx</span><span class="p">)</span>  <span class="c1"># Remove exp_cfg argument.</span>

        <span class="c1"># Validate config path.</span>
        <span class="n">cfg_error</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">exp_cfg_file_path</span> <span class="o">=</span> <span class="n">cmd_line_args</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">exp_cfg_idx</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">exp_cfg_file_path</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;--&quot;</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">IndexError</span>
            <span class="n">exp_cfg_file_path</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">exp_cfg_file_path</span>
                <span class="k">if</span> <span class="n">exp_cfg_file_path</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.yml&quot;</span><span class="p">)</span>
                <span class="k">else</span> <span class="n">exp_cfg_file_path</span> <span class="o">+</span> <span class="s2">&quot;.yml&quot;</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">osp</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">exp_cfg_file_path</span><span class="p">):</span>
                <span class="n">project_path</span> <span class="o">=</span> <span class="n">osp</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">osp</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">osp</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">),</span> <span class="s2">&quot;..&quot;</span><span class="p">))</span>
                <span class="n">exp_cfg_file_path</span> <span class="o">=</span> <span class="n">osp</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span>
                    <span class="n">osp</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">project_path</span><span class="p">,</span> <span class="s2">&quot;experiments&quot;</span><span class="p">,</span> <span class="n">exp_cfg_file_path</span><span class="p">)</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">osp</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">exp_cfg_file_path</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span>
                        <span class="s2">&quot;No experiment configuration file found at &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="n">exp_cfg_file_path</span><span class="si">}</span><span class="s2">&#39;.&quot;</span>
                    <span class="p">)</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">IndexError</span><span class="p">,</span> <span class="ne">FileNotFoundError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">cfg_error</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="ne">IndexError</span><span class="p">):</span>
                <span class="n">log_to_std_out</span><span class="p">(</span>
                    <span class="s2">&quot;You did not supply a experiment configuration path. As a result &quot;</span>
                    <span class="s2">&quot;the &#39;--exp_cfg&#39; argument has been ignored.&quot;</span><span class="p">,</span>
                    <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;warning&quot;</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">log_to_std_out</span><span class="p">(</span>
                    <span class="p">(</span>
                        <span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="o">+</span> <span class="s2">&quot; As a result the &#39;--exp_cfg&#39; argument has been &quot;</span>
                        <span class="o">+</span> <span class="s2">&quot;ignored.&quot;</span>
                    <span class="p">),</span>
                    <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;warning&quot;</span><span class="p">,</span>
                <span class="p">)</span>

        <span class="c1"># Read configuration values.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">cfg_error</span><span class="p">:</span>
            <span class="c1"># Load exp config.</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">exp_cfg_file_path</span><span class="p">)</span> <span class="k">as</span> <span class="n">stream</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">exp_cfg_params</span> <span class="o">=</span> <span class="n">YAML</span><span class="p">(</span><span class="n">typ</span><span class="o">=</span><span class="s2">&quot;safe&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">stream</span><span class="p">)</span>
                <span class="k">except</span> <span class="n">YAMLError</span><span class="p">:</span>
                    <span class="n">log_to_std_out</span><span class="p">(</span>
                        <span class="s2">&quot;Something went wrong while trying to load the experiment  &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;config in &#39;</span><span class="si">{</span><span class="n">exp_cfg_file_path</span><span class="si">}</span><span class="s2">. As a result the --exp_cfg &quot;</span>
                        <span class="s2">&quot;argument has been ignored.&quot;</span><span class="p">,</span>
                        <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;warning&quot;</span><span class="p">,</span>
                    <span class="p">)</span>

            <span class="c1"># Retrieve values from exp config.</span>
            <span class="n">log_to_std_out</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Experiment hyperparameters loaded from &#39;</span><span class="si">{</span><span class="n">exp_cfg_file_path</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">,</span>
                <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;info&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">exp_cfg_params</span><span class="p">:</span>
                <span class="n">log_to_std_out</span><span class="p">(</span>
                    <span class="s2">&quot;No hyperparameters were found in your experiment config. &quot;</span>
                    <span class="s2">&quot;As a result the &#39;--exp_cfg&#39; flag has been ignored.&quot;</span><span class="p">,</span>
                    <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;warning&quot;</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Remove &#39;alg_name&#39; from exp_cfg if &#39;--exp_cfg&#39; was not the first arg.</span>
                <span class="k">if</span> <span class="n">exp_cfg_idx</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="k">if</span> <span class="s2">&quot;alg_name&quot;</span> <span class="ow">in</span> <span class="n">exp_cfg_params</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                        <span class="n">cmd_line_args</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">exp_cfg_params</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;alg_name&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">exp_cfg_params</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;alg_name&quot;</span><span class="p">)</span>

                <span class="c1"># Append cfg hyperparameters to the input arguments.</span>
                <span class="c1"># NOTE: Here we assume comma or space separated strings to be variants.</span>
                <span class="n">exp_cfg_params</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="p">(</span><span class="n">key</span> <span class="k">if</span> <span class="n">key</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;--&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="s2">&quot;--&quot;</span> <span class="o">+</span> <span class="n">key</span><span class="p">):</span> <span class="n">val</span>
                    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">exp_cfg_params</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                <span class="p">}</span>
                <span class="n">exp_cfg_params</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
                    <span class="n">flatten</span><span class="p">(</span>
                        <span class="p">[</span>
                            <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">key</span><span class="p">),</span> <span class="n">_parse_hyperparameter_variants</span><span class="p">(</span><span class="n">val</span><span class="p">)]</span>
                            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">exp_cfg_params</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                        <span class="p">]</span>
                    <span class="p">)</span>
                <span class="p">)</span>

                <span class="c1"># Remove None values so that they are treated as on/off flags (see</span>
                <span class="c1"># https://docs.python.org/3/library/argparse.html#core-functionality).</span>
                <span class="n">exp_cfg_params</span> <span class="o">=</span> <span class="p">[</span><span class="n">val</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">exp_cfg_params</span> <span class="k">if</span> <span class="n">val</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">]</span>
            <span class="n">cmd_line_args</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">exp_cfg_params</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">cmd_line_args</span></div>


<div class="viewcode-block" id="_parse_eval_cfg"><a class="viewcode-back" href="../../autoapi/stable_learning_control/run/index.html#stable_learning_control.run._parse_eval_cfg">[docs]</a><span class="k">def</span> <span class="nf">_parse_eval_cfg</span><span class="p">(</span><span class="n">cmd_line_args</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;This function parses the cmd line args to see if it contains the ``eval_cfg``</span>
<span class="sd">    flag. If this flag is present it uses the ``eval_cfg`` file path (next cmd_line arg)</span>
<span class="sd">    to add any hyperparameters found in this eval configuration file to the cmd</span>
<span class="sd">    line arguments.</span>

<span class="sd">    Args:</span>
<span class="sd">        cmd_line_args (list): The cmd line input arguments.</span>

<span class="sd">    Returns:</span>
<span class="sd">        list: Modified cmd line argument list that also contains any hyperparameters</span>
<span class="sd">            that were specified in a eval cfg file.</span>

<span class="sd">    .. note::</span>
<span class="sd">        This function assumes comma/space separated strings (i.e. ``5, 3, 2`` or</span>
<span class="sd">        ``5 3 2``)) to be hyperparmeter variants.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="s2">&quot;--eval_cfg&quot;</span> <span class="ow">in</span> <span class="n">cmd_line_args</span><span class="p">:</span>
        <span class="c1"># If &#39;eval_robustness&#39; is not first argument add it to the front.</span>
        <span class="k">if</span> <span class="s2">&quot;eval_robustness&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">cmd_line_args</span><span class="p">:</span>
            <span class="n">cmd_line_args</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;eval_robustness&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">eval_robustness_idx</span> <span class="o">=</span> <span class="n">cmd_line_args</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;eval_robustness&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">eval_robustness_idx</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">cmd_line_args</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;eval_robustness&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                <span class="n">cmd_line_args</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;eval_robustness&quot;</span><span class="p">)</span>

        <span class="c1"># Retrieve &#39;--eval_cfg&#39; argument.</span>
        <span class="n">eval_cfg_idx</span> <span class="o">=</span> <span class="n">cmd_line_args</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;--eval_cfg&quot;</span><span class="p">)</span>
        <span class="n">cmd_line_args</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">eval_cfg_idx</span><span class="p">)</span>  <span class="c1"># Remove eval_cfg argument.</span>

        <span class="c1"># Validate config path.</span>
        <span class="n">cfg_error</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">eval_cfg_file_path</span> <span class="o">=</span> <span class="n">cmd_line_args</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">eval_cfg_idx</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">eval_cfg_file_path</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;--&quot;</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">IndexError</span>
            <span class="n">eval_cfg_file_path</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">eval_cfg_file_path</span>
                <span class="k">if</span> <span class="n">eval_cfg_file_path</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.yml&quot;</span><span class="p">)</span>
                <span class="k">else</span> <span class="n">eval_cfg_file_path</span> <span class="o">+</span> <span class="s2">&quot;.yml&quot;</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">osp</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">eval_cfg_file_path</span><span class="p">):</span>
                <span class="n">project_path</span> <span class="o">=</span> <span class="n">osp</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">osp</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">osp</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">),</span> <span class="s2">&quot;..&quot;</span><span class="p">))</span>
                <span class="n">eval_cfg_file_path</span> <span class="o">=</span> <span class="n">osp</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span>
                    <span class="n">osp</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">project_path</span><span class="p">,</span> <span class="s2">&quot;experiments&quot;</span><span class="p">,</span> <span class="n">eval_cfg_file_path</span><span class="p">)</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">osp</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">eval_cfg_file_path</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span>
                        <span class="s2">&quot;No eval configuration file found at &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="n">eval_cfg_file_path</span><span class="si">}</span><span class="s2">&#39;.&quot;</span>
                    <span class="p">)</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">IndexError</span><span class="p">,</span> <span class="ne">FileNotFoundError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">cfg_error</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="ne">IndexError</span><span class="p">):</span>
                <span class="n">log_to_std_out</span><span class="p">(</span>
                    <span class="s2">&quot;You did not supply a eval configuration path. As a result &quot;</span>
                    <span class="s2">&quot;the &#39;--eval_cfg&#39; argument has been ignored.&quot;</span><span class="p">,</span>
                    <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;warning&quot;</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">log_to_std_out</span><span class="p">(</span>
                    <span class="p">(</span>
                        <span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="o">+</span> <span class="s2">&quot; As a result the &#39;--eval_cfg&#39; argument has been &quot;</span>
                        <span class="o">+</span> <span class="s2">&quot;ignored.&quot;</span>
                    <span class="p">),</span>
                    <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;warning&quot;</span><span class="p">,</span>
                <span class="p">)</span>

        <span class="c1"># Read configuration values.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">cfg_error</span><span class="p">:</span>
            <span class="c1"># Load eval config.</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">eval_cfg_file_path</span><span class="p">)</span> <span class="k">as</span> <span class="n">stream</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">eval_cfg_params</span> <span class="o">=</span> <span class="n">YAML</span><span class="p">(</span><span class="n">typ</span><span class="o">=</span><span class="s2">&quot;safe&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">stream</span><span class="p">)</span>
                <span class="k">except</span> <span class="n">YAMLError</span><span class="p">:</span>
                    <span class="n">log_to_std_out</span><span class="p">(</span>
                        <span class="s2">&quot;Something went wrong while trying to load the eval config &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;in &#39;</span><span class="si">{</span><span class="n">eval_cfg_file_path</span><span class="si">}</span><span class="s2">. As a result the --eval_cfg &quot;</span>
                        <span class="s2">&quot;argument has been ignored.&quot;</span><span class="p">,</span>
                        <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;warning&quot;</span><span class="p">,</span>
                    <span class="p">)</span>

            <span class="c1"># Retrieve values from eval config.</span>
            <span class="n">log_to_std_out</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Eval parameters loaded from &#39;</span><span class="si">{</span><span class="n">eval_cfg_file_path</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">,</span>
                <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;info&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">eval_cfg_params</span><span class="p">:</span>
                <span class="n">log_to_std_out</span><span class="p">(</span>
                    <span class="s2">&quot;No eval parameters were found in your eval config. As a result &quot;</span>
                    <span class="s2">&quot;the &#39;--eval_cfg&#39; flag has been ignored.&quot;</span><span class="p">,</span>
                    <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;warning&quot;</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Ensure that the eval config contains a disturber key.</span>
                <span class="k">if</span> <span class="s2">&quot;disturber&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">eval_cfg_params</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="s2">&quot;The eval config does not contain a &#39;disturber&#39; key.&quot;</span>
                    <span class="p">)</span>

                <span class="c1"># Remove the disturber key and extend the cmd line arguments with it.</span>
                <span class="n">disturber</span> <span class="o">=</span> <span class="n">eval_cfg_params</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;disturber&quot;</span><span class="p">)</span>
                <span class="n">cmd_line_args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">disturber</span><span class="p">)</span>

                <span class="c1"># Append other cfg parameters to the input arguments.</span>
                <span class="c1"># NOTE: Here we assume comma or space separated strings to be variants.</span>
                <span class="n">eval_cfg_params</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="p">(</span><span class="n">key</span> <span class="k">if</span> <span class="n">key</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;--&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="s2">&quot;--&quot;</span> <span class="o">+</span> <span class="n">key</span><span class="p">):</span> <span class="n">val</span>
                    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">eval_cfg_params</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                <span class="p">}</span>
                <span class="n">eval_cfg_params</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
                    <span class="n">flatten</span><span class="p">(</span>
                        <span class="p">[</span>
                            <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">key</span><span class="p">),</span> <span class="n">_parse_hyperparameter_variants</span><span class="p">(</span><span class="n">val</span><span class="p">)]</span>
                            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">eval_cfg_params</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                        <span class="p">]</span>
                    <span class="p">)</span>
                <span class="p">)</span>

                <span class="c1"># Remove None values so that they are treated as on/off flags (see</span>
                <span class="c1"># https://docs.python.org/3/library/argparse.html#core-functionality).</span>
                <span class="n">eval_cfg_params</span> <span class="o">=</span> <span class="p">[</span><span class="n">val</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">eval_cfg_params</span> <span class="k">if</span> <span class="n">val</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">]</span>
            <span class="n">cmd_line_args</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">eval_cfg_params</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">cmd_line_args</span></div>


<div class="viewcode-block" id="_add_backend_to_cmd"><a class="viewcode-back" href="../../autoapi/stable_learning_control/run/index.html#stable_learning_control.run._add_backend_to_cmd">[docs]</a><span class="k">def</span> <span class="nf">_add_backend_to_cmd</span><span class="p">(</span><span class="n">cmd</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Adds the backend suffix to the input command.</span>

<span class="sd">    Args:</span>
<span class="sd">        cmd (str): The cmd string.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (tuple): tuple containing:</span>

<span class="sd">            - cmd (:obj:`str`): The new cmd.</span>
<span class="sd">            - backend (:obj:`str`): The used backend (options: ``tf2`` or ``pytorch``).</span>

<span class="sd">    Raises:</span>
<span class="sd">        AssertError:</span>
<span class="sd">            Raised when a the TensorFlow backend is requested but TensorFlow is not</span>
<span class="sd">            installed.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">cmd</span> <span class="ow">in</span> <span class="n">BASE_ALGO_NAMES</span><span class="p">:</span>
        <span class="n">backend</span> <span class="o">=</span> <span class="n">DEFAULT_BACKEND</span><span class="p">[</span><span class="n">cmd</span><span class="p">]</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">Using default backend (</span><span class="si">%s</span><span class="s2">) for </span><span class="si">%s</span><span class="s2">.</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">backend</span><span class="p">,</span> <span class="n">cmd</span><span class="p">))</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="n">cmd</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">backend</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">backend</span> <span class="o">=</span> <span class="n">cmd</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="c1"># Throw error if tf algorithm is requested but TensorFlow is not installed.</span>
    <span class="k">if</span> <span class="n">backend</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;tf2&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">tf_installed</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span>
                <span class="n">friendly_err</span><span class="p">(</span>
                    <span class="s2">&quot;You requested a TensorFlow algorithm but TensorFlow is not &quot;</span>
                    <span class="s2">&quot;installed. Did you run the `pip install .[tf2]` command?&quot;</span>
                <span class="p">)</span>
            <span class="p">)</span>
    <span class="k">return</span> <span class="n">cmd</span><span class="p">,</span> <span class="n">backend</span></div>


<div class="viewcode-block" id="_process_arg"><a class="viewcode-back" href="../../autoapi/stable_learning_control/run/index.html#stable_learning_control.run._process_arg">[docs]</a><span class="k">def</span> <span class="nf">_process_arg</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="n">backend</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Process an arg by eval-ing it, so users can specify more than just strings at</span>
<span class="sd">    the command line (eg allows for users to give functions as args).</span>

<span class="sd">    Args:</span>
<span class="sd">        arg (str): Input argument.</span>
<span class="sd">        backend (str): The machine learning backend you want to use. Options are ``tf2``</span>
<span class="sd">            or ``torch``. By default ``None``, meaning no backend is assumed.</span>

<span class="sd">    Returns:</span>
<span class="sd">        obj: Processed input argument.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">safer_eval</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="n">backend</span><span class="o">=</span><span class="n">backend</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">arg</span></div>


<div class="viewcode-block" id="_add_with_backends"><a class="viewcode-back" href="../../autoapi/stable_learning_control/run/index.html#stable_learning_control.run._add_with_backends">[docs]</a><span class="k">def</span> <span class="nf">_add_with_backends</span><span class="p">(</span><span class="n">algo_list</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Helper function to build lists with backend-specific function names</span>

<span class="sd">    Args:</span>
<span class="sd">        algo_list (list): List of algorithms.</span>

<span class="sd">    Returns:</span>
<span class="sd">       list: The algorithms with their backends.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">algo_list_with_backends</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">algo_list</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">algo</span> <span class="ow">in</span> <span class="n">algo_list</span><span class="p">:</span>
        <span class="n">algo_list_with_backends</span> <span class="o">+=</span> <span class="p">[</span><span class="n">algo</span> <span class="o">+</span> <span class="s2">&quot;_tf2&quot;</span><span class="p">,</span> <span class="n">algo</span> <span class="o">+</span> <span class="s2">&quot;_pytorch&quot;</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">algo_list_with_backends</span></div>


<div class="viewcode-block" id="_parse_and_execute_grid_search"><a class="viewcode-back" href="../../autoapi/stable_learning_control/run/index.html#stable_learning_control.run._parse_and_execute_grid_search">[docs]</a><span class="k">def</span> <span class="nf">_parse_and_execute_grid_search</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Interprets algorithm name and cmd line args into an ExperimentGrid.</span>

<span class="sd">    Args:</span>
<span class="sd">        cmd (str): The requested CLI command.</span>
<span class="sd">        args (list): The command arguments.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ImportError: A custom import error if TensorFlow is not installed.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">cmd</span><span class="p">,</span> <span class="n">backend</span> <span class="o">=</span> <span class="n">_add_backend_to_cmd</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>

    <span class="c1"># warning.</span>
    <span class="n">algo</span> <span class="o">=</span> <span class="n">safer_eval</span><span class="p">(</span><span class="s2">&quot;stable_learning_control.&quot;</span> <span class="o">+</span> <span class="n">cmd</span><span class="p">,</span> <span class="n">backend</span><span class="o">=</span><span class="n">backend</span><span class="p">)</span>

    <span class="c1"># Before all else, check to see if any of the flags is &#39;help&#39;.</span>
    <span class="n">valid_help</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;--help&quot;</span><span class="p">,</span> <span class="s2">&quot;-h&quot;</span><span class="p">,</span> <span class="s2">&quot;help&quot;</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">any</span><span class="p">([</span><span class="n">arg</span> <span class="ow">in</span> <span class="n">valid_help</span> <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">args</span><span class="p">]):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">Showing docstring for stable_learning_control.&quot;</span> <span class="o">+</span> <span class="n">cmd</span> <span class="o">+</span> <span class="s2">&quot;:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="si">{}</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">cleandoc</span><span class="p">(</span><span class="n">algo</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n\t</span><span class="s2">&quot;</span><span class="p">)))</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>

    <span class="c1"># Make first pass through args to build base arg_dict. Anything</span>
    <span class="c1"># with a &#39;--&#39; in front of it is an argument flag and everything after,</span>
    <span class="c1"># until the next flag, is a possible value.</span>
    <span class="n">arg_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">arg</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">args</span><span class="p">):</span>
        <span class="k">assert</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="s2">&quot;--&quot;</span> <span class="ow">in</span> <span class="n">arg</span><span class="p">,</span> <span class="n">friendly_err</span><span class="p">(</span><span class="s2">&quot;You didn&#39;t specify a first flag.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;--&quot;</span> <span class="ow">in</span> <span class="n">arg</span><span class="p">:</span>
            <span class="n">arg_key</span> <span class="o">=</span> <span class="n">arg</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)</span>
            <span class="n">arg_dict</span><span class="p">[</span><span class="n">arg_key</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">arg_dict</span><span class="p">[</span><span class="n">arg_key</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_process_arg</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="n">backend</span><span class="o">=</span><span class="n">backend</span><span class="p">))</span>

    <span class="c1"># Make second pass through, to catch flags that have no vals.</span>
    <span class="c1"># Assume such flags indicate that a boolean parameter should have</span>
    <span class="c1"># value True.</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">arg_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">v</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Third pass: check for user-supplied shorthands, where a key has</span>
    <span class="c1"># the form --keyname[kn]. The thing in brackets, &#39;kn&#39;, is the</span>
    <span class="c1"># shorthand. NOTE: modifying a dict while looping through its</span>
    <span class="c1"># contents is dangerous, and breaks in 3.6+. We loop over a fixed list</span>
    <span class="c1"># of keys to avoid this issue.</span>
    <span class="n">given_shorthands</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">fixed_keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">arg_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">fixed_keys</span><span class="p">:</span>
        <span class="n">p1</span><span class="p">,</span> <span class="n">p2</span> <span class="o">=</span> <span class="n">k</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;[&quot;</span><span class="p">),</span> <span class="n">k</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;]&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">p1</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">p2</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># Both &#39;[&#39; and &#39;]&#39; found, so shorthand has been given</span>
            <span class="n">k_new</span> <span class="o">=</span> <span class="n">k</span><span class="p">[:</span><span class="n">p1</span><span class="p">]</span>
            <span class="n">shorthand</span> <span class="o">=</span> <span class="n">k</span><span class="p">[</span><span class="n">p1</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">:</span> <span class="n">p2</span><span class="p">]</span>
            <span class="n">given_shorthands</span><span class="p">[</span><span class="n">k_new</span><span class="p">]</span> <span class="o">=</span> <span class="n">shorthand</span>
            <span class="n">arg_dict</span><span class="p">[</span><span class="n">k_new</span><span class="p">]</span> <span class="o">=</span> <span class="n">arg_dict</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="k">del</span> <span class="n">arg_dict</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>

    <span class="c1"># Penultimate pass: sugar. Allow some special shortcuts in arg naming,</span>
    <span class="c1"># eg treat &quot;env&quot; the same as &quot;env_name&quot;. This is super specific</span>
    <span class="c1"># to Stable Learning Control implementations, and may be hard to maintain.</span>
    <span class="c1"># These special shortcuts are described by SUBSTITUTIONS.</span>
    <span class="k">for</span> <span class="n">special_name</span><span class="p">,</span> <span class="n">true_name</span> <span class="ow">in</span> <span class="n">SUBSTITUTIONS</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">special_name</span> <span class="ow">in</span> <span class="n">arg_dict</span><span class="p">:</span>
            <span class="c1"># swap it in arg dict.</span>
            <span class="n">arg_dict</span><span class="p">[</span><span class="n">true_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">arg_dict</span><span class="p">[</span><span class="n">special_name</span><span class="p">]</span>
            <span class="k">del</span> <span class="n">arg_dict</span><span class="p">[</span><span class="n">special_name</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">special_name</span> <span class="ow">in</span> <span class="n">given_shorthands</span><span class="p">:</span>
            <span class="c1"># point the shortcut to the right name.</span>
            <span class="n">given_shorthands</span><span class="p">[</span><span class="n">true_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">given_shorthands</span><span class="p">[</span><span class="n">special_name</span><span class="p">]</span>
            <span class="k">del</span> <span class="n">given_shorthands</span><span class="p">[</span><span class="n">special_name</span><span class="p">]</span>

    <span class="c1"># Determine experiment name. If not given by user, will be determined</span>
    <span class="c1"># by the algorithm name.</span>
    <span class="k">if</span> <span class="s2">&quot;exp_name&quot;</span> <span class="ow">in</span> <span class="n">arg_dict</span><span class="p">:</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">arg_dict</span><span class="p">[</span><span class="s2">&quot;exp_name&quot;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="n">friendly_err</span><span class="p">(</span>
            <span class="s2">&quot;You can only provide one value for exp_name.&quot;</span>
        <span class="p">)</span>
        <span class="n">exp_name</span> <span class="o">=</span> <span class="n">arg_dict</span><span class="p">[</span><span class="s2">&quot;exp_name&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">del</span> <span class="n">arg_dict</span><span class="p">[</span><span class="s2">&quot;exp_name&quot;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">exp_name</span> <span class="o">=</span> <span class="s2">&quot;cmd_&quot;</span> <span class="o">+</span> <span class="n">cmd</span>

    <span class="c1"># Special handling for environment: make sure that env_name is a real,</span>
    <span class="c1"># registered gymnasium environment.</span>
    <span class="n">validate_gym_env</span><span class="p">(</span><span class="n">arg_dict</span><span class="p">)</span>

    <span class="c1"># Final pass: check for the special args that go to the &#39;run&#39; command</span>
    <span class="c1"># for an experiment grid, separate them from the arg dict, and make sure</span>
    <span class="c1"># that they have unique values. The special args are given by RUN_KEYS.</span>
    <span class="n">run_kwargs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">RUN_KEYS</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">arg_dict</span><span class="p">:</span>
            <span class="n">val</span> <span class="o">=</span> <span class="n">arg_dict</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="n">friendly_err</span><span class="p">(</span>
                <span class="s2">&quot;You can only provide one value for </span><span class="si">%s</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="n">k</span>
            <span class="p">)</span>
            <span class="n">run_kwargs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">del</span> <span class="n">arg_dict</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>

    <span class="c1"># Make sure that if num_cpu &gt; 1, the algorithm being used is compatible</span>
    <span class="c1"># with MPI.</span>
    <span class="k">if</span> <span class="s2">&quot;num_cpu&quot;</span> <span class="ow">in</span> <span class="n">run_kwargs</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span><span class="n">run_kwargs</span><span class="p">[</span><span class="s2">&quot;num_cpu&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
        <span class="k">assert</span> <span class="n">cmd</span> <span class="ow">in</span> <span class="n">_add_with_backends</span><span class="p">(</span><span class="n">MPI_COMPATIBLE_ALGOS</span><span class="p">),</span> <span class="n">friendly_err</span><span class="p">(</span>
            <span class="s2">&quot;This algorithm can&#39;t be run with num_cpu &gt; 1.&quot;</span>
        <span class="p">)</span>

    <span class="c1"># Construct and execute the experiment grid.</span>
    <span class="n">eg</span> <span class="o">=</span> <span class="n">ExperimentGrid</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">exp_name</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">arg_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">eg</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">shorthand</span><span class="o">=</span><span class="n">given_shorthands</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">))</span>
    <span class="n">eg</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">algo</span><span class="p">,</span> <span class="o">**</span><span class="n">run_kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="run"><a class="viewcode-back" href="../../utils/run_utils.html#stable_learning_control.run.run">[docs]</a><span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="n">input_args</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Function that is used to run the experiments. I modified this component</span>
<span class="sd">    compared to the SpiningUp such that I can import it in other</span>
<span class="sd">    modules.</span>

<span class="sd">    Args:</span>
<span class="sd">        input_args (list): List with command line argument.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">valid_algos</span> <span class="o">=</span> <span class="n">_add_with_backends</span><span class="p">(</span><span class="n">BASE_ALGO_NAMES</span><span class="p">)</span>
    <span class="n">valid_utils</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;plot&quot;</span><span class="p">,</span> <span class="s2">&quot;test_policy&quot;</span><span class="p">,</span> <span class="s2">&quot;eval_robustness&quot;</span><span class="p">]</span>
    <span class="n">valid_help</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;--help&quot;</span><span class="p">,</span> <span class="s2">&quot;-h&quot;</span><span class="p">,</span> <span class="s2">&quot;help&quot;</span><span class="p">]</span>
    <span class="n">valid_version</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;--version&quot;</span><span class="p">]</span>
    <span class="n">valid_specials</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;--exp_cfg&quot;</span><span class="p">,</span> <span class="s2">&quot;--eval_cfg&quot;</span><span class="p">]</span>
    <span class="n">valid_cmds</span> <span class="o">=</span> <span class="n">valid_algos</span> <span class="o">+</span> <span class="n">valid_utils</span> <span class="o">+</span> <span class="n">valid_help</span> <span class="o">+</span> <span class="n">valid_version</span> <span class="o">+</span> <span class="n">valid_specials</span>

    <span class="c1"># Load hyperparameters from a experimental/eval configuration file if supplied.</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">argv</span> <span class="o">=</span> <span class="n">_parse_exp_cfg</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">argv</span> <span class="o">=</span> <span class="n">_parse_eval_cfg</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span>
    <span class="n">cmd</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">input_args</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="s2">&quot;help&quot;</span>

    <span class="k">if</span> <span class="n">cmd</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">valid_cmds</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="n">friendly_err</span><span class="p">(</span>
                <span class="s2">&quot;Input argument &#39;</span><span class="si">{}</span><span class="s2">&#39; is invalid. Please select an algorithm or &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">cmd</span>
                <span class="p">)</span>
                <span class="o">+</span> <span class="s2">&quot;utility which is implemented in the stable_learning_control &quot;</span>
                <span class="s2">&quot;package.&quot;</span>
            <span class="p">)</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="n">cmd</span> <span class="ow">in</span> <span class="n">valid_help</span><span class="p">:</span>
        <span class="c1"># Before all else, check to see if any of the flags is &#39;help&#39;.</span>

        <span class="c1"># List commands that are available.</span>
        <span class="n">str_valid_cmds</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n\t</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n\t</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">valid_algos</span> <span class="o">+</span> <span class="n">valid_utils</span> <span class="o">+</span> <span class="n">valid_version</span><span class="p">)</span>
        <span class="n">help_msg</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">dedent</span><span class="p">(</span>
<span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Experiment in Stable Learning Control from the command line with</span>

<span class="sd">            \tpython -m stable_learning_control.run CMD [ARGS...]</span>

<span class="sd">            where CMD is a valid command. Current valid commands are:</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="p">)</span>
            <span class="o">+</span> <span class="n">str_valid_cmds</span>
        <span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">help_msg</span><span class="p">)</span>

        <span class="c1"># Provide some useful details for algorithm running.</span>
        <span class="n">subs_list</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;--&quot;</span> <span class="o">+</span> <span class="n">k</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">17</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;for&quot;</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;--&quot;</span> <span class="o">+</span> <span class="n">v</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">SUBSTITUTIONS</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="p">]</span>
        <span class="n">str_valid_subs</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n\t</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n\t</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">subs_list</span><span class="p">)</span>
        <span class="n">special_info</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">dedent</span><span class="p">(</span>
<span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            FYI: When running an algorithm, any keyword argument to the</span>
<span class="sd">            algorithm function can be used as a flag, eg</span>

<span class="sd">            \tpython -m stable_learning_control.run sac --env HalfCheetah-v4 --clip_ratio 0.1</span>

<span class="sd">            If you need a quick refresher on valid kwargs, get the docstring</span>
<span class="sd">            with</span>

<span class="sd">            \tpython -m stable_learning_control.run [algo] --help</span>

<span class="sd">            See the &quot;Running Experiments&quot; docs page for more details.</span>

<span class="sd">            Also: Some common but long flags can be substituted for shorter</span>
<span class="sd">            ones. Valid substitutions are:</span>
<span class="sd">            &quot;&quot;&quot;</span>  <span class="c1"># noqa: E501</span>
            <span class="p">)</span>
            <span class="o">+</span> <span class="n">str_valid_subs</span>
        <span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">special_info</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">cmd</span> <span class="ow">in</span> <span class="n">valid_version</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;stable_learning_control, version </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">__version__</span><span class="p">))</span>
    <span class="k">elif</span> <span class="n">cmd</span> <span class="ow">in</span> <span class="n">valid_utils</span><span class="p">:</span>
        <span class="c1"># Execute the correct utility file.</span>
        <span class="n">runfile</span> <span class="o">=</span> <span class="n">osp</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">osp</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">osp</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)),</span> <span class="s2">&quot;utils&quot;</span><span class="p">,</span> <span class="n">cmd</span> <span class="o">+</span> <span class="s2">&quot;.py&quot;</span><span class="p">)</span>
        <span class="n">args</span> <span class="o">=</span> <span class="p">[</span><span class="n">sys</span><span class="o">.</span><span class="n">executable</span> <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">executable</span> <span class="k">else</span> <span class="s2">&quot;python&quot;</span><span class="p">,</span> <span class="n">runfile</span><span class="p">]</span> <span class="o">+</span> <span class="n">input_args</span><span class="p">[</span>
            <span class="mi">2</span><span class="p">:</span>
        <span class="p">]</span>
        <span class="n">subprocess</span><span class="o">.</span><span class="n">check_call</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">env</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Assume that the user plans to execute an algorithm. Run custom</span>
        <span class="c1"># parsing on the arguments and build a grid search to execute.</span>
        <span class="n">args</span> <span class="o">=</span> <span class="n">input_args</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span>
        <span class="n">_parse_and_execute_grid_search</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span></div>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This is a wrapper allowing command-line interfaces to individual algorithms and the</span>
<span class="sd">    plot, test policy and test robustness utilities.</span>

<span class="sd">    For utilities, it only checks which thing to run, and calls the appropriate file,</span>
<span class="sd">    passing all arguments through.</span>

<span class="sd">    For algorithms, it sets up an ExperimentGrid object and uses the ExperimentGrid run</span>
<span class="sd">    routine to execute each possible experiment.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">run</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Rick Staa.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>